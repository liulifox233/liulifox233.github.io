
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Welcome to the meltyland">
      
      
      
        <link rel="canonical" href="https://blog.meltyland.dev/2025/08/22/zxhpc-2025-writeup/">
      
      
        <link rel="prev" href="../../../02/28/bupt-%E8%BD%AC%E4%B8%93%E4%B8%9A%E5%B0%8F%E8%AE%B0/">
      
      
      
      <link rel="icon" href="../../../../assets/logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>ZXHPC 2025 Writeup - MeltyLand</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/hpc-visualizations.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/chat.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#zxhpc-2025-writeup" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../.." title="MeltyLand" class="md-header__button md-logo" aria-label="MeltyLand" data-md-component="logo">
      
  <img src="../../../../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MeltyLand
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ZXHPC 2025 Writeup
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="light" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="dark" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/liulifox233/liulifox233.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    liulifox233/liulifox233.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../.." class="md-tabs__link">
          
  
  
    
  
  Posts

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../records/" class="md-tabs__link">
          
  
  
    
  
  Records

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../notes/" class="md-tabs__link">
          
  
  
    
  
  Notes

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../about/" class="md-tabs__link">
          
  
  
    
  
  About

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="MeltyLand" class="md-nav__button md-logo" aria-label="MeltyLand" data-md-component="logo">
      
  <img src="../../../../assets/logo.svg" alt="logo">

    </a>
    MeltyLand
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/liulifox233/liulifox233.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    liulifox233/liulifox233.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Posts
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Posts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    归档
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            归档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2025/08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    八月 2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2025/02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    二月 2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2024/12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    十二月 2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2024/07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    七月 2024
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    分类
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            分类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/bupt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BUPT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/tech/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tech
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/%E7%94%9F%E6%B4%BB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    生活
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../records/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Records
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Records
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    分类
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            分类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../records/category/tech/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tech
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../notes/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Notes
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Notes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    database
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            database
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notes/database/cap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CAP定理及其证明
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    japanese
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            japanese
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notes/japanese/plan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    日本語を勉強しましょう？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notes/japanese/case-particles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    格助词
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            About
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About Me
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      环境信息
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cos-sim" class="md-nav__link">
    <span class="md-ellipsis">
      cos-sim
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cos-sim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      优化思路
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      小规模优化
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#md5-bf" class="md-nav__link">
    <span class="md-ellipsis">
      md5-bf
    </span>
  </a>
  
    <nav class="md-nav" aria-label="md5-bf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rndgen" class="md-nav__link">
    <span class="md-ellipsis">
      RndGen的数学表示
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../.." class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    回到主页
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="https://avatars.githubusercontent.com/u/88608708" alt="流离">
                    </span>
                    <span class="md-profile__description">
                      <strong>
                        
                          流离
                        
                      </strong>
                      <br>
                      誰も知らないところまで
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    元数据
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2025-08-22 00:00:00+00:00" class="md-ellipsis">2025年8月22日星期五</time>
                      </div>
                    </li>
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15 13h1.5v2.82l2.44 1.41-.75 1.3L15 16.69zm4-5H5v11h4.67c-.43-.91-.67-1.93-.67-3a7 7 0 0 1 7-7c1.07 0 2.09.24 3 .67zM5 21a2 2 0 0 1-2-2V5c0-1.11.89-2 2-2h1V1h2v2h8V1h2v2h1a2 2 0 0 1 2 2v6.1c1.24 1.26 2 2.99 2 4.9a7 7 0 0 1-7 7c-1.91 0-3.64-.76-4.9-2zm11-9.85A4.85 4.85 0 0 0 11.15 16c0 2.68 2.17 4.85 4.85 4.85A4.85 4.85 0 0 0 20.85 16c0-2.68-2.17-4.85-4.85-4.85"/></svg>
                          <time datetime="2025-08-25 00:00:00+00:00" class="md-ellipsis">2025年8月25日星期一</time>
                        </div>
                      </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg>
                          <span class="md-ellipsis">
                            分类于
                            
                              <a href="../../../../category/tech/">Tech</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              需要 17 分钟阅读时间
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Tags -->


<!-- Hero image -->

<div class="mdx-hero__image" style="overflow: hidden; aspect-ratio: 16 / 9; margin-bottom: 20px;">
    <img
        src="https://blog.meltyland.dev/assets/posts/kotoha.webp"
        alt=""
        draggable="false"
        style="width: 100%; height: 100%; object-fit: cover; object-position: center;"
    >
</div>


<!--
  Hack: check whether the content contains a h1 headline. If it doesn't, the
  page title (or respectively site name) is used as the main headline.
-->


<!-- Actions -->

  
    <a href="https://github.com/liulifox233/liulifox233.github.io/edit/main/docs/posts/ZXHPC_writeup.md" title="编辑此页" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/liulifox233/liulifox233.github.io/raw/main/docs/posts/ZXHPC_writeup.md" title="查看本页的源代码" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<!-- Page content -->
<h1 id="zxhpc-2025-writeup">ZXHPC 2025 Writeup<a class="headerlink" href="#zxhpc-2025-writeup" title="Permanent link">&para;</a></h1>
<details class="tip" open="open">
<summary>Tip</summary>
<p>Kotoha かわすぎ😭</p>
<p>都去听 Kotoha Cover 的 <a href="https://www.youtube.com/watch?v=UdXxY3kLdVc">#あくあ色ぱれっと</a> 😡</p>
</details>
<!-- more -->

<p>因为是一边调整生物钟一边打比赛（虽然到最后也没成功把生物钟调整回来），凌晨上分应该很诡异吧www</p>
<p>最后拿到了 Rank 2 的成绩，其中 <code>md5-new</code> 和 <code>traffic-detector</code> 都拿到了 SOTA 的成绩，总体来说还是很满意的吧</p>
<p><img alt="" src="../../../../assets/posts/rank.webp" /></p>
<h2 id="_1">环境信息<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>评测姬的CPU信息如下</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Architecture:          x86_64
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>CPU op-mode(s):        32-bit, 64-bit
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>Byte Order:            Little Endian
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>CPU(s):                40
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>On-line CPU(s) list:   0-39
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>Thread(s) per core:    1
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>Core(s) per socket:    20
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>Socket(s):             2
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>NUMA node(s):          2
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>Vendor ID:             GenuineIntel
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>CPU family:            6
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>Model:                 85
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>Model name:            Intel(R) Xeon(R) Gold 6148 CPU @ 2.40GHz
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>Stepping:              4
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>CPU MHz:               2600.001
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>CPU max MHz:           2401.0000
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>CPU min MHz:           1000.0000
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>BogoMIPS:              4800.00
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>Virtualization:        VT-x
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>L1d cache:             32K
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>L1i cache:             32K
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>L2 cache:              1024K
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>L3 cache:              28160K
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>NUMA node0 CPU(s):     0-19
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>NUMA node1 CPU(s):     20-39
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>Flags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc art arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc cpuid aperfmperf pni pclmulqdq dtes64 ds_cpl vmx smx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm 3dnowprefetch cpuid_fault epb cat_l3 cdp_l3 invpcid_single pti intel_ppin ssbd mba ibrs ibpb stibp tpr_shadow vnmi flexpriority ept vpid ept_ad fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm cqm mpx rdt_a avx512f avx512dq rdseed adx smap clflushopt clwb intel_pt avx512cd avx512bw avx512vl xsaveopt xsavec xgetbv1 xsaves cqm_llc cqm_occup_llc cqm_mbm_total cqm_mbm_local dtherm ida arat pln pts pku ospke md_clear flush_l1d arch_capabilities
</span></code></pre></div>
<p>编译器信息：</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1"><code>HPCI</code></label><label for="__tabbed_1_2"><code>Local</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>g++ (binhub) 10.1.0
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>Copyright (C) 2020 Free Software Foundation, Inc.
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>This is free software; see the source for copying conditions.  There is NO
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>g++ (Ubuntu 14.2.0-19ubuntu2) 14.2.0
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>Copyright (C) 2024 Free Software Foundation, Inc.
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>This is free software; see the source for copying conditions.  There is NO
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
</span></code></pre></div>
</div>
</div>
</div>
<p><code>a+b</code>、<code>cos-sim</code>、<code>md5-bf</code>、<code>md5-new</code> 均使用集群版本为 10.1.0 的 g++ 编译器</p>
<p><code>traffic-detector</code> 为本机编译静态链接，上传二进制文件</p>
<h2 id="cos-sim">cos-sim<a class="headerlink" href="#cos-sim" title="Permanent link">&para;</a></h2>
<p>这个题目的核心任务是，给我们 <code>N</code> 个 <code>D</code> 维的向量，要我们算出每个向量和其他所有向量的余弦相似度，然后找出最大的那四个。</p>
<p>最直观、最暴力的想法，就是老老实实地写两层循环：外层循环遍历向量 <code>i</code>，内层循环遍历向量 <code>j</code>，然后在最里面根据公式计算 <code>i</code> 和 <code>j</code> 的相似度。这个算法的复杂度大概是 <code>O(N² * D)</code>。考虑到 <code>N</code> 最大能到 20000，<code>D</code> 是 4096，这个计算量是天文数字，肯定会超时。</p>
<h3 id="_2">优化思路<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>我们先看一下余弦相似度的公式：</p>
<div class="arithmatex">\[
\text{similarity}(A, B) = \frac{A \cdot B}{\|A\| \cdot \|B\|}
\]</div>
<p>分母部分的 <span class="arithmatex">\(||A||\)</span> 和 <span class="arithmatex">\(||B||\)</span> 是向量的模长，计算它需要开平方，这是一个非常耗时的操作。如果在 <code>N*N</code> 的循环里反复计算，性能损失会非常大</p>
<p>我们可以预先将所有向量都处理成单位向量，即归一化</p>
<p>归一化之后，所有向量的模长 <span class="arithmatex">\(||V||\)</span> 都变成了 1。这时公式就变成了：</p>
<div class="arithmatex">\[
\text{similarity}(A', B') = \frac{A' \cdot B'}{1 \cdot 1} = A' \cdot B'
\]</div>
<p>计算余弦相似度被简化成了只计算点积。</p>
<p>这一步的开销是 <code>O(N * D)</code>，相比于后续 <code>N²</code> 级别的计算，这点预处理的开销完全可以忽略不计，但它带来的收益是巨大的</p>
<p>之后的问题就是如何高效计算 N*N 的点积矩阵，我首先想到了这个方式：</p>
<p>把 <code>N</code> 个 <code>D</code> 维向量看成一个 <code>N x D</code> 的矩阵 <code>M</code>。那么，<code>M</code> 乘以它自己的转置 <code>M^T</code>，得到的结果 <code>S = M * M^T</code> 是一个 <code>N x N</code> 的矩阵。这个结果矩阵 <code>S</code> 里面，<code>S_ij</code> 的值正好就是向量 <code>i</code> 和向量 <code>j</code> 的点积</p>
<p>这个操作可以通过 BLAS 库里的 <code>cblas_sgemm</code> 函数（通用矩阵乘法）一步完成</p>
<h3 id="_3">小规模优化<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>然后就能开香槟...不对，怎么小矩阵算得这么慢呢？暴力逐点计算在小规模反而更快！？</p>
<p>那就根据 N 的大小判断使用暴力计算还是矩阵乘法！</p>
<p>写了一个 <code>benchmark.cpp</code> 程序在不同的 <code>N</code> 值下对这两个方案进行了性能测试</p>
<details class="note">
<summary>benchmark.cpp</summary>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdint&gt;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cmath&gt;</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cblas.h&gt;</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;omp.h&gt;</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;chrono&gt;</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="o">::</span><span class="nn">chrono</span><span class="p">;</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="c1">// 方案1：逐点计算</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="kt">void</span><span class="w"> </span><span class="nf">brute_force</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">    </span><span class="cp">#pragma omp parallel for</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">vec_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">D</span><span class="p">;</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="mi">-1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">-1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">-1</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="mi">-1</span><span class="p">;</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">vec_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">D</span><span class="p">;</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">sim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cblas_sdot</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">vec_i</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">vec_j</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sim</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">){</span><span class="w"> </span><span class="n">d</span><span class="o">=</span><span class="n">c</span><span class="p">;</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="n">b</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="n">a</span><span class="p">;</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="n">sim</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">sim</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">){</span><span class="w"> </span><span class="n">d</span><span class="o">=</span><span class="n">c</span><span class="p">;</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="n">b</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="n">sim</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">sim</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">c</span><span class="p">){</span><span class="w"> </span><span class="n">d</span><span class="o">=</span><span class="n">c</span><span class="p">;</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="n">sim</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">sim</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">d</span><span class="p">){</span><span class="w"> </span><span class="n">d</span><span class="o">=</span><span class="n">sim</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a><span class="p">}</span>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a><span class="c1">// 方案2：矩阵乘法</span>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a><span class="kt">void</span><span class="w"> </span><span class="nf">gemm_based</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cos_matrix</span><span class="p">((</span><span class="kt">size_t</span><span class="p">)</span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">N</span><span class="p">);</span>
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a><span class="w">    </span><span class="n">cblas_sgemm</span><span class="p">(</span>
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a><span class="w">        </span><span class="n">CblasRowMajor</span><span class="p">,</span><span class="w"> </span><span class="n">CblasNoTrans</span><span class="p">,</span><span class="w"> </span><span class="n">CblasTrans</span><span class="p">,</span>
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a><span class="w">        </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">,</span>
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a><span class="w">        </span><span class="mf">1.0f</span><span class="p">,</span>
</span><span id="__span-3-38"><a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a><span class="w">        </span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">D</span><span class="p">,</span>
</span><span id="__span-3-39"><a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a><span class="w">        </span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">D</span><span class="p">,</span>
</span><span id="__span-3-40"><a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a><span class="w">        </span><span class="mf">0.0f</span><span class="p">,</span>
</span><span id="__span-3-41"><a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a><span class="w">        </span><span class="n">cos_matrix</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">N</span>
</span><span id="__span-3-42"><a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-3-43"><a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a><span class="w">    </span><span class="cp">#pragma omp parallel for</span>
</span><span id="__span-3-44"><a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-45"><a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a><span class="w">        </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cos_matrix</span><span class="p">.</span><span class="n">data</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">N</span><span class="p">;</span>
</span><span id="__span-3-46"><a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a><span class="w">        </span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">;</span>
</span><span id="__span-3-47"><a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="mi">-1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">-1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">-1</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="mi">-1</span><span class="p">;</span>
</span><span id="__span-3-48"><a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
</span><span id="__span-3-49"><a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a><span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">sim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
</span><span id="__span-3-50"><a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">sim</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">){</span><span class="w"> </span><span class="n">d</span><span class="o">=</span><span class="n">c</span><span class="p">;</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="n">b</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="n">a</span><span class="p">;</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="n">sim</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-51"><a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">sim</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">){</span><span class="w"> </span><span class="n">d</span><span class="o">=</span><span class="n">c</span><span class="p">;</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="n">b</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="n">sim</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-52"><a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">sim</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">c</span><span class="p">){</span><span class="w"> </span><span class="n">d</span><span class="o">=</span><span class="n">c</span><span class="p">;</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="n">sim</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-53"><a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">sim</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">d</span><span class="p">){</span><span class="w"> </span><span class="n">d</span><span class="o">=</span><span class="n">sim</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-54"><a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-3-55"><a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-3-56"><a id="__codelineno-3-56" name="__codelineno-3-56" href="#__codelineno-3-56"></a><span class="p">}</span>
</span><span id="__span-3-57"><a id="__codelineno-3-57" name="__codelineno-3-57" href="#__codelineno-3-57"></a>
</span><span id="__span-3-58"><a id="__codelineno-3-58" name="__codelineno-3-58" href="#__codelineno-3-58"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-59"><a id="__codelineno-3-59" name="__codelineno-3-59" href="#__codelineno-3-59"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4096</span><span class="p">;</span>
</span><span id="__span-3-60"><a id="__codelineno-3-60" name="__codelineno-3-60" href="#__codelineno-3-60"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">testNs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">256</span><span class="p">,</span><span class="w"> </span><span class="mi">512</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w"> </span><span class="mi">1500</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="mi">3000</span><span class="p">,</span><span class="w"> </span><span class="mi">4000</span><span class="p">};</span>
</span><span id="__span-3-61"><a id="__codelineno-3-61" name="__codelineno-3-61" href="#__codelineno-3-61"></a>
</span><span id="__span-3-62"><a id="__codelineno-3-62" name="__codelineno-3-62" href="#__codelineno-3-62"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Benchmarking brute_force vs gemm...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-3-63"><a id="__codelineno-3-63" name="__codelineno-3-63" href="#__codelineno-3-63"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">testNs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-64"><a id="__codelineno-3-64" name="__codelineno-3-64" href="#__codelineno-3-64"></a><span class="w">        </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">((</span><span class="kt">size_t</span><span class="p">)</span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">D</span><span class="p">);</span>
</span><span id="__span-3-65"><a id="__codelineno-3-65" name="__codelineno-3-65" href="#__codelineno-3-65"></a><span class="w">        </span><span class="c1">// 随机初始化</span>
</span><span id="__span-3-66"><a id="__codelineno-3-66" name="__codelineno-3-66" href="#__codelineno-3-66"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-67"><a id="__codelineno-3-67" name="__codelineno-3-67" href="#__codelineno-3-67"></a><span class="w">            </span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">rand</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">RAND_MAX</span><span class="p">;</span>
</span><span id="__span-3-68"><a id="__codelineno-3-68" name="__codelineno-3-68" href="#__codelineno-3-68"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-3-69"><a id="__codelineno-3-69" name="__codelineno-3-69" href="#__codelineno-3-69"></a><span class="w">        </span><span class="c1">// 归一化</span>
</span><span id="__span-3-70"><a id="__codelineno-3-70" name="__codelineno-3-70" href="#__codelineno-3-70"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-71"><a id="__codelineno-3-71" name="__codelineno-3-71" href="#__codelineno-3-71"></a><span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">sum</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-3-72"><a id="__codelineno-3-72" name="__codelineno-3-72" href="#__codelineno-3-72"></a><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">D</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">D</span><span class="o">+</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">D</span><span class="o">+</span><span class="n">j</span><span class="p">];</span>
</span><span id="__span-3-73"><a id="__codelineno-3-73" name="__codelineno-3-73" href="#__codelineno-3-73"></a><span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">inv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0f</span><span class="o">/</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span><span class="o">+</span><span class="mf">1e-12f</span><span class="p">);</span>
</span><span id="__span-3-74"><a id="__codelineno-3-74" name="__codelineno-3-74" href="#__codelineno-3-74"></a><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">D</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">D</span><span class="o">+</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">inv</span><span class="p">;</span>
</span><span id="__span-3-75"><a id="__codelineno-3-75" name="__codelineno-3-75" href="#__codelineno-3-75"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-3-76"><a id="__codelineno-3-76" name="__codelineno-3-76" href="#__codelineno-3-76"></a>
</span><span id="__span-3-77"><a id="__codelineno-3-77" name="__codelineno-3-77" href="#__codelineno-3-77"></a><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
</span><span id="__span-3-78"><a id="__codelineno-3-78" name="__codelineno-3-78" href="#__codelineno-3-78"></a><span class="w">        </span><span class="n">brute_force</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
</span><span id="__span-3-79"><a id="__codelineno-3-79" name="__codelineno-3-79" href="#__codelineno-3-79"></a><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
</span><span id="__span-3-80"><a id="__codelineno-3-80" name="__codelineno-3-80" href="#__codelineno-3-80"></a><span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">).</span><span class="n">count</span><span class="p">();</span>
</span><span id="__span-3-81"><a id="__codelineno-3-81" name="__codelineno-3-81" href="#__codelineno-3-81"></a>
</span><span id="__span-3-82"><a id="__codelineno-3-82" name="__codelineno-3-82" href="#__codelineno-3-82"></a><span class="w">        </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
</span><span id="__span-3-83"><a id="__codelineno-3-83" name="__codelineno-3-83" href="#__codelineno-3-83"></a><span class="w">        </span><span class="n">gemm_based</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
</span><span id="__span-3-84"><a id="__codelineno-3-84" name="__codelineno-3-84" href="#__codelineno-3-84"></a><span class="w">        </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
</span><span id="__span-3-85"><a id="__codelineno-3-85" name="__codelineno-3-85" href="#__codelineno-3-85"></a><span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">).</span><span class="n">count</span><span class="p">();</span>
</span><span id="__span-3-86"><a id="__codelineno-3-86" name="__codelineno-3-86" href="#__codelineno-3-86"></a>
</span><span id="__span-3-87"><a id="__codelineno-3-87" name="__codelineno-3-87" href="#__codelineno-3-87"></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;N=&quot;</span><span class="o">&lt;&lt;</span><span class="n">N</span><span class="o">&lt;&lt;</span><span class="s">&quot; brute=&quot;</span><span class="o">&lt;&lt;</span><span class="n">t1</span><span class="o">&lt;&lt;</span><span class="s">&quot; ms  gemm=&quot;</span><span class="o">&lt;&lt;</span><span class="n">t2</span><span class="o">&lt;&lt;</span><span class="s">&quot; ms  -&gt; faster: &quot;</span>
</span><span id="__span-3-88"><a id="__codelineno-3-88" name="__codelineno-3-88" href="#__codelineno-3-88"></a><span class="w">             </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">t1</span><span class="o">&lt;</span><span class="n">t2</span><span class="o">?</span><span class="s">&quot;brute&quot;</span><span class="o">:</span><span class="s">&quot;gemm&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span id="__span-3-89"><a id="__codelineno-3-89" name="__codelineno-3-89" href="#__codelineno-3-89"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-3-90"><a id="__codelineno-3-90" name="__codelineno-3-90" href="#__codelineno-3-90"></a>
</span><span id="__span-3-91"><a id="__codelineno-3-91" name="__codelineno-3-91" href="#__codelineno-3-91"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-3-92"><a id="__codelineno-3-92" name="__codelineno-3-92" href="#__codelineno-3-92"></a><span class="p">}</span>
</span></code></pre></div>
</details>
<p>结果：
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>Benchmarking brute_force vs gemm...
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>N=256 brute=34 ms  gemm=66 ms  -&gt; faster: brute
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>N=512 brute=21 ms  gemm=55 ms  -&gt; faster: brute
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>N=1024 brute=23 ms  gemm=22 ms  -&gt; faster: gemm
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>N=1500 brute=48 ms  gemm=25 ms  -&gt; faster: gemm
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>N=2000 brute=165 ms  gemm=49 ms  -&gt; faster: gemm
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>N=3000 brute=556 ms  gemm=98 ms  -&gt; faster: gemm
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>N=4000 brute=1020 ms  gemm=73 ms  -&gt; faster: gemm
</span></code></pre></div></p>
<ul>
<li>当 <code>N</code> 比较小的时候（比如几百），<code>cblas_sdot</code> 反而更快。因为 <code>sgemm</code> 虽然理论效率高，但它本身有一些固定的启动开销，而且内存分配也需要时间。数据量小的时候，这些额外开销就显得比较突出了</li>
<li>当 <code>N</code> 增大到某个临界点之后，<code>cblas_sgemm</code> 的优势就体现出来了，它的计算效率增长得更快</li>
</ul>
<p>通过我们的测试，这个临界点大约在 <code>N = 1024</code> 左右</p>
<p>因此最终使用混合策略
- 如果 <code>N &lt; 1024</code>，我们就用逐点计算的方案
- 如果 <code>N &gt;= 1024</code>，我们就用矩阵乘法的方案</p>
<p>这样，无论输入数据的规模如何，程序都能自动选择当前最优的算法路径</p>
<p>最终得分 99.0 pts</p>
<p><del>1pts差在N=1000时，懒得凹分</del></p>
<h2 id="md5-bf">md5-bf<a class="headerlink" href="#md5-bf" title="Permanent link">&para;</a></h2>
<details class="note">
<summary>md5-bf</summary>
<p><strong>MD5 Brute Force</strong></p>
<p><strong>题目内容</strong></p>
<p>MD5 是一种广泛使用的哈希函数，于1992年公开。它将任意长度的输入映射为128位的哈希值。尽管 MD5在密码学上已被证明不够安全，但它仍然在数据完整性校验等领域得到广泛应用。</p>
<p>在本题中，你需要实现一个程序，加速MD5哈希计算。你的任务是找到一个给定的目标哈希值对应的原始输入。</p>
<p>具体来说，你将使用一个简单的伪随机数生成器（PRNG）来生成一系列可能的输入，并计算它们的MD5哈希值。你的目标是找到第一个生成的输入，其MD5哈希值与给定的目标哈希值匹配，并输出该输入在生成序列中的位置。</p>
<p>生成器由 3 个异或移位寄存器（Xorshift）组成，初始种子由 3 个 64 位无符号整数表示。每次调用生成器时，它会更新寄存器的状态并得到3个64位无符号整数的伪随机数，然后在每个整数之后插入 8 个 0 字节，形成一个 48 字节的输入。</p>
<p>生成器的C++实现如下：</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">RndGen</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="p">{</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="n">RndGen</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s0</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s1</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">        </span><span class="n">s_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s0</span><span class="p">;</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">        </span><span class="n">s_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="p">;</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">        </span><span class="n">s_</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s2</span><span class="p">;</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">    </span><span class="n">RndGen</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">        </span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xorshift64</span><span class="p">(</span><span class="n">s_</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">        </span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">        </span><span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xorshift64</span><span class="p">(</span><span class="n">s_</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">        </span><span class="n">out</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">        </span><span class="n">out</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xorshift64</span><span class="p">(</span><span class="n">s_</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">        </span><span class="n">out</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="k">private</span><span class="o">:</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">xorshift64</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="o">&amp;</span><span class="n">state</span><span class="p">)</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="w">        </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">;</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">13</span><span class="p">);</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">7</span><span class="p">);</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">17</span><span class="p">);</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="w">        </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s_</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a><span class="p">};</span>
</span></code></pre></div>
<p><strong>输入格式</strong></p>
<p>每组测试数据包含5个测试点，每个测试点2行，共10行。</p>
<p>每个测试点的第一行包含 3 个以空格分隔的 16 进制字符串，表示生成器的初始种子。
每个测试点第二行包含一个 16 进制字符串，表示目标哈希值。</p>
<p><strong>输出格式</strong></p>
<p>输出5行，每行输出一个整数 n，表示该测试点的目标哈希值是由生成器生成的第 n 个原始输入的 MD5 哈希值。</p>
<p><strong>样例</strong></p>
<p><strong>输入样例</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>f266a54e3e47a23c fdaae989f0a7211c e6aa6f98e36deedf
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>82d45fa866fa60b64d71164df84c75c9
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>17a7cd855b73cdac cc4323d166e03be9 b00bc0b3bd5894fa
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>7218bba8b911ab47c6327bb5dbe61b59
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>dea8b42aaeadda81 ec4cc7cb402de9d9 ce3826dac217a356
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>1a74d9f4a21cbe42d7eb6476505f8ca9
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>ca1114b1a8399b94 4f22b32081209bca 3db2ed9884246d92
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>38978e0a05d932b7c6abb0969ddf9d42
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>8af2347938b775bf d03e9af34bb95deb 3542f798e87dc7b4
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>edceface43f62178ada45fd121932c13
</span></code></pre></div>
<p><strong>输出样例</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>1
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>12
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>123
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>1234
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>12345
</span></code></pre></div>
<p><strong>评分标准</strong></p>
<p>10 个测试点，每个测试点的得分具体如下：</p>
<ul>
<li>输出结果必须正确。结尾的空格和换行将被忽略。结果不正确的，该测试点得0分。</li>
<li>计该测试点的运行时间为 <span class="arithmatex">\(t\)</span> 秒、正确答案为 <span class="arithmatex">\(n\)</span>，则该测试点得分为 <span class="arithmatex">\(\dfrac{60}{t} - 1\)</span>，其中 <span class="arithmatex">\(t\)</span> 的最大值为 60 秒。如果运行时间超过 60 秒，则该测试点得 0 分。</li>
</ul>
<p>总分为所有测试点得分之和，并根据全部选手的最高分进行归一化，线性缩放到满分 100 分。</p>
</details>
<p>看到题目第一时间就想到先用 <a href="https://en.wikipedia.org/wiki/Single_instruction,_multiple_data">SIMD</a> 加速，因为不管是给出的随机数生成器，还是md5值的生成，都是很容易向量化的算法</p>
<p>通过 <code>lscpu</code> 查看 CPU flags，集群支持我们使用 AVX2 和 AVX512 指令集进行 SIMD 优化</p>
<p>Github 搜索 <code>simd</code> 和 <code>md5</code>，第一个出现的就是 <a href="https://github.com/minio/md5-simd">minio/md5-simd</a></p>
<p>于是出于偷懒考虑(bushi)，使用了 Go 实现的第一版实验算法</p>
<p>当然实验是大☆失☆败了，实验下来消耗时间远高题目要求最高时间，我是Golang苦手不会优化真是太对不起了，因此切换到了传统的 C++ 方案</p>
<p>使用了 <a href="https://github.com/ashbob999/md5-simd">ashbob999/md5-simd</a> 这个库只实现了最高8路的向量化 MD5 计算，但为了简化MD5算法实现，可以之后再优化到 AVX512 16路计算</p>
<p>题目在比赛期间更新了，标为<code>md5-bf</code>的代码为旧题目实现，标为<code>md5-new</code>的则为新版</p>
<details class="note">
<summary>参考代码 Ver1.0 ( md5-bf test1用时约21.703960709s )</summary>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdint&gt;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdexcept&gt;</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;omp.h&gt;</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;md5-simd/source/simd/md5-simd.h&quot;</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="c1">// 题目提供的伪随机数生成器 (PRNG)</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">RndGen</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="p">{</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="n">RndGen</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s0</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s1</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="p">{</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">    </span><span class="n">s_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s0</span><span class="p">;</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">    </span><span class="n">s_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="p">;</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">    </span><span class="n">s_</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s2</span><span class="p">;</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="p">}</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="n">RndGen</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="c1">// 生成48字节的输入数据</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="kt">void</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="p">{</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="w">    </span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xorshift64</span><span class="p">(</span><span class="n">s_</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w">    </span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="w">    </span><span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xorshift64</span><span class="p">(</span><span class="n">s_</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">    </span><span class="n">out</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="w">    </span><span class="n">out</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xorshift64</span><span class="p">(</span><span class="n">s_</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w">    </span><span class="n">out</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="p">}</span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="k">private</span><span class="o">:</span>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">xorshift64</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="o">&amp;</span><span class="n">state</span><span class="p">)</span>
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="p">{</span>
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">;</span>
</span><span id="__span-8-38"><a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">13</span><span class="p">);</span>
</span><span id="__span-8-39"><a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">7</span><span class="p">);</span>
</span><span id="__span-8-40"><a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">17</span><span class="p">);</span>
</span><span id="__span-8-41"><a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a><span class="w">    </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-8-42"><a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-8-43"><a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a><span class="p">}</span>
</span><span id="__span-8-44"><a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a><span class="c1">// s_[3] is unused padding to avoid false sharing</span>
</span><span id="__span-8-45"><a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s_</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span><span id="__span-8-46"><a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a><span class="p">};</span>
</span><span id="__span-8-47"><a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a>
</span><span id="__span-8-48"><a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a>
</span><span id="__span-8-49"><a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a><span class="c1">// 辅助函数：将16进制字符串解析为16字节的MD5摘要 (4个 uint32_t)</span>
</span><span id="__span-8-50"><a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a><span class="c1">// MD5的输出是小端序的，这个函数正确处理字节序</span>
</span><span id="__span-8-51"><a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a><span class="kt">void</span><span class="w"> </span><span class="nf">parse_hex_digest</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">hex</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">digest</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-52"><a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hex</span><span class="p">.</span><span class="n">length</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-53"><a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Invalid hex digest length.&quot;</span><span class="p">);</span>
</span><span id="__span-8-54"><a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a><span class="p">}</span>
</span><span id="__span-8-55"><a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-56"><a id="__codelineno-8-56" name="__codelineno-8-56" href="#__codelineno-8-56"></a><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">stoull</span><span class="p">(</span><span class="n">hex</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span>
</span><span id="__span-8-57"><a id="__codelineno-8-57" name="__codelineno-8-57" href="#__codelineno-8-57"></a><span class="w">    </span><span class="c1">// MD5的每个32位字在输出时是小端字节序</span>
</span><span id="__span-8-58"><a id="__codelineno-8-58" name="__codelineno-8-58" href="#__codelineno-8-58"></a><span class="w">    </span><span class="n">digest</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">part</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xFF000000</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">24</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-8-59"><a id="__codelineno-8-59" name="__codelineno-8-59" href="#__codelineno-8-59"></a><span class="w">                </span><span class="p">((</span><span class="n">part</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x00FF0000</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w">  </span><span class="o">|</span>
</span><span id="__span-8-60"><a id="__codelineno-8-60" name="__codelineno-8-60" href="#__codelineno-8-60"></a><span class="w">                </span><span class="p">((</span><span class="n">part</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x0000FF00</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w">  </span><span class="o">|</span>
</span><span id="__span-8-61"><a id="__codelineno-8-61" name="__codelineno-8-61" href="#__codelineno-8-61"></a><span class="w">                </span><span class="p">((</span><span class="n">part</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x000000FF</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">24</span><span class="p">);</span>
</span><span id="__span-8-62"><a id="__codelineno-8-62" name="__codelineno-8-62" href="#__codelineno-8-62"></a><span class="p">}</span>
</span><span id="__span-8-63"><a id="__codelineno-8-63" name="__codelineno-8-63" href="#__codelineno-8-63"></a><span class="p">}</span>
</span><span id="__span-8-64"><a id="__codelineno-8-64" name="__codelineno-8-64" href="#__codelineno-8-64"></a>
</span><span id="__span-8-65"><a id="__codelineno-8-65" name="__codelineno-8-65" href="#__codelineno-8-65"></a>
</span><span id="__span-8-66"><a id="__codelineno-8-66" name="__codelineno-8-66" href="#__codelineno-8-66"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
</span><span id="__span-8-67"><a id="__codelineno-8-67" name="__codelineno-8-67" href="#__codelineno-8-67"></a><span class="p">{</span>
</span><span id="__span-8-68"><a id="__codelineno-8-68" name="__codelineno-8-68" href="#__codelineno-8-68"></a><span class="c1">// 加速C++标准IO</span>
</span><span id="__span-8-69"><a id="__codelineno-8-69" name="__codelineno-8-69" href="#__codelineno-8-69"></a><span class="n">std</span><span class="o">::</span><span class="n">ios_base</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
</span><span id="__span-8-70"><a id="__codelineno-8-70" name="__codelineno-8-70" href="#__codelineno-8-70"></a><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
</span><span id="__span-8-71"><a id="__codelineno-8-71" name="__codelineno-8-71" href="#__codelineno-8-71"></a>
</span><span id="__span-8-72"><a id="__codelineno-8-72" name="__codelineno-8-72" href="#__codelineno-8-72"></a><span class="c1">// 1. 读取输入</span>
</span><span id="__span-8-73"><a id="__codelineno-8-73" name="__codelineno-8-73" href="#__codelineno-8-73"></a><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">s0_hex</span><span class="p">,</span><span class="w"> </span><span class="n">s1_hex</span><span class="p">,</span><span class="w"> </span><span class="n">s2_hex</span><span class="p">;</span>
</span><span id="__span-8-74"><a id="__codelineno-8-74" name="__codelineno-8-74" href="#__codelineno-8-74"></a><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">s0_hex</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">s1_hex</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">s2_hex</span><span class="p">;</span>
</span><span id="__span-8-75"><a id="__codelineno-8-75" name="__codelineno-8-75" href="#__codelineno-8-75"></a>
</span><span id="__span-8-76"><a id="__codelineno-8-76" name="__codelineno-8-76" href="#__codelineno-8-76"></a><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">target_hex</span><span class="p">;</span>
</span><span id="__span-8-77"><a id="__codelineno-8-77" name="__codelineno-8-77" href="#__codelineno-8-77"></a><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">target_hex</span><span class="p">;</span>
</span><span id="__span-8-78"><a id="__codelineno-8-78" name="__codelineno-8-78" href="#__codelineno-8-78"></a>
</span><span id="__span-8-79"><a id="__codelineno-8-79" name="__codelineno-8-79" href="#__codelineno-8-79"></a><span class="c1">// 2. 解析输入</span>
</span><span id="__span-8-80"><a id="__codelineno-8-80" name="__codelineno-8-80" href="#__codelineno-8-80"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">stoull</span><span class="p">(</span><span class="n">s0_hex</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span>
</span><span id="__span-8-81"><a id="__codelineno-8-81" name="__codelineno-8-81" href="#__codelineno-8-81"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">stoull</span><span class="p">(</span><span class="n">s1_hex</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span>
</span><span id="__span-8-82"><a id="__codelineno-8-82" name="__codelineno-8-82" href="#__codelineno-8-82"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">stoull</span><span class="p">(</span><span class="n">s2_hex</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span>
</span><span id="__span-8-83"><a id="__codelineno-8-83" name="__codelineno-8-83" href="#__codelineno-8-83"></a>
</span><span id="__span-8-84"><a id="__codelineno-8-84" name="__codelineno-8-84" href="#__codelineno-8-84"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">target_digest</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span><span id="__span-8-85"><a id="__codelineno-8-85" name="__codelineno-8-85" href="#__codelineno-8-85"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-86"><a id="__codelineno-8-86" name="__codelineno-8-86" href="#__codelineno-8-86"></a><span class="w">    </span><span class="n">parse_hex_digest</span><span class="p">(</span><span class="n">target_hex</span><span class="p">,</span><span class="w"> </span><span class="n">target_digest</span><span class="p">);</span>
</span><span id="__span-8-87"><a id="__codelineno-8-87" name="__codelineno-8-87" href="#__codelineno-8-87"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-88"><a id="__codelineno-8-88" name="__codelineno-8-88" href="#__codelineno-8-88"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Error parsing target hash: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-8-89"><a id="__codelineno-8-89" name="__codelineno-8-89" href="#__codelineno-8-89"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-8-90"><a id="__codelineno-8-90" name="__codelineno-8-90" href="#__codelineno-8-90"></a><span class="p">}</span>
</span><span id="__span-8-91"><a id="__codelineno-8-91" name="__codelineno-8-91" href="#__codelineno-8-91"></a>
</span><span id="__span-8-92"><a id="__codelineno-8-92" name="__codelineno-8-92" href="#__codelineno-8-92"></a><span class="c1">// 共享变量，用于存储结果。volatile 确保所有线程能看到最新值。</span>
</span><span id="__span-8-93"><a id="__codelineno-8-93" name="__codelineno-8-93" href="#__codelineno-8-93"></a><span class="k">volatile</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">found_n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
</span><span id="__span-8-94"><a id="__codelineno-8-94" name="__codelineno-8-94" href="#__codelineno-8-94"></a>
</span><span id="__span-8-95"><a id="__codelineno-8-95" name="__codelineno-8-95" href="#__codelineno-8-95"></a><span class="c1">// 3. 使用OpenMP并行计算</span>
</span><span id="__span-8-96"><a id="__codelineno-8-96" name="__codelineno-8-96" href="#__codelineno-8-96"></a><span class="cp">#pragma omp parallel</span>
</span><span id="__span-8-97"><a id="__codelineno-8-97" name="__codelineno-8-97" href="#__codelineno-8-97"></a><span class="p">{</span>
</span><span id="__span-8-98"><a id="__codelineno-8-98" name="__codelineno-8-98" href="#__codelineno-8-98"></a><span class="w">    </span><span class="c1">// 每个线程获取自己的ID和总线程数</span>
</span><span id="__span-8-99"><a id="__codelineno-8-99" name="__codelineno-8-99" href="#__codelineno-8-99"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">omp_get_thread_num</span><span class="p">();</span>
</span><span id="__span-8-100"><a id="__codelineno-8-100" name="__codelineno-8-100" href="#__codelineno-8-100"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">num_threads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">omp_get_num_threads</span><span class="p">();</span>
</span><span id="__span-8-101"><a id="__codelineno-8-101" name="__codelineno-8-101" href="#__codelineno-8-101"></a>
</span><span id="__span-8-102"><a id="__codelineno-8-102" name="__codelineno-8-102" href="#__codelineno-8-102"></a><span class="w">    </span><span class="c1">// 每个线程拥有自己的生成器实例，避免状态冲突</span>
</span><span id="__span-8-103"><a id="__codelineno-8-103" name="__codelineno-8-103" href="#__codelineno-8-103"></a><span class="w">    </span><span class="n">RndGen</span><span class="w"> </span><span class="n">generator</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span><span class="w"> </span><span class="n">s1</span><span class="p">,</span><span class="w"> </span><span class="n">s2</span><span class="p">);</span>
</span><span id="__span-8-104"><a id="__codelineno-8-104" name="__codelineno-8-104" href="#__codelineno-8-104"></a>
</span><span id="__span-8-105"><a id="__codelineno-8-105" name="__codelineno-8-105" href="#__codelineno-8-105"></a><span class="w">    </span><span class="c1">// 每个线程拥有自己的MD5计算器实例</span>
</span><span id="__span-8-106"><a id="__codelineno-8-106" name="__codelineno-8-106" href="#__codelineno-8-106"></a><span class="w">    </span><span class="n">md5_simd</span><span class="o">::</span><span class="n">MD5_SIMD</span><span class="w"> </span><span class="n">md5_calc</span><span class="p">;</span>
</span><span id="__span-8-107"><a id="__codelineno-8-107" name="__codelineno-8-107" href="#__codelineno-8-107"></a>
</span><span id="__span-8-108"><a id="__codelineno-8-108" name="__codelineno-8-108" href="#__codelineno-8-108"></a><span class="w">    </span><span class="c1">// 准备计算所需的数据结构</span>
</span><span id="__span-8-109"><a id="__codelineno-8-109" name="__codelineno-8-109" href="#__codelineno-8-109"></a><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">input_buffer</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
</span><span id="__span-8-110"><a id="__codelineno-8-110" name="__codelineno-8-110" href="#__codelineno-8-110"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">input_buffer</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-8-111"><a id="__codelineno-8-111" name="__codelineno-8-111" href="#__codelineno-8-111"></a><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">48</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// 输入长度固定为48字节</span>
</span><span id="__span-8-112"><a id="__codelineno-8-112" name="__codelineno-8-112" href="#__codelineno-8-112"></a>
</span><span id="__span-8-113"><a id="__codelineno-8-113" name="__codelineno-8-113" href="#__codelineno-8-113"></a><span class="w">    </span><span class="c1">// &quot;快进&quot;生成器状态，使每个线程从正确的交错起点开始</span>
</span><span id="__span-8-114"><a id="__codelineno-8-114" name="__codelineno-8-114" href="#__codelineno-8-114"></a><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">dummy_buffer</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
</span><span id="__span-8-115"><a id="__codelineno-8-115" name="__codelineno-8-115" href="#__codelineno-8-115"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">thread_id</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-116"><a id="__codelineno-8-116" name="__codelineno-8-116" href="#__codelineno-8-116"></a><span class="w">        </span><span class="n">generator</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">dummy_buffer</span><span class="p">);</span>
</span><span id="__span-8-117"><a id="__codelineno-8-117" name="__codelineno-8-117" href="#__codelineno-8-117"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-118"><a id="__codelineno-8-118" name="__codelineno-8-118" href="#__codelineno-8-118"></a>
</span><span id="__span-8-119"><a id="__codelineno-8-119" name="__codelineno-8-119" href="#__codelineno-8-119"></a><span class="w">    </span><span class="c1">// 4. 开始并行搜索循环</span>
</span><span id="__span-8-120"><a id="__codelineno-8-120" name="__codelineno-8-120" href="#__codelineno-8-120"></a><span class="w">    </span><span class="c1">// 每个线程的步长是总线程数</span>
</span><span id="__span-8-121"><a id="__codelineno-8-121" name="__codelineno-8-121" href="#__codelineno-8-121"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">found_n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">num_threads</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-122"><a id="__codelineno-8-122" name="__codelineno-8-122" href="#__codelineno-8-122"></a>
</span><span id="__span-8-123"><a id="__codelineno-8-123" name="__codelineno-8-123" href="#__codelineno-8-123"></a><span class="w">        </span><span class="c1">// 生成第n个输入</span>
</span><span id="__span-8-124"><a id="__codelineno-8-124" name="__codelineno-8-124" href="#__codelineno-8-124"></a><span class="w">        </span><span class="n">generator</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">input_buffer</span><span class="p">);</span>
</span><span id="__span-8-125"><a id="__codelineno-8-125" name="__codelineno-8-125" href="#__codelineno-8-125"></a>
</span><span id="__span-8-126"><a id="__codelineno-8-126" name="__codelineno-8-126" href="#__codelineno-8-126"></a><span class="w">        </span><span class="c1">// 计算MD5哈希</span>
</span><span id="__span-8-127"><a id="__codelineno-8-127" name="__codelineno-8-127" href="#__codelineno-8-127"></a><span class="w">        </span><span class="c1">// 使用&lt;1, false&gt;模板参数表示一次计算1个哈希，并且不做长度检查（因为长度固定）</span>
</span><span id="__span-8-128"><a id="__codelineno-8-128" name="__codelineno-8-128" href="#__codelineno-8-128"></a><span class="w">        </span><span class="n">md5_calc</span><span class="p">.</span><span class="n">calculate</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="o">&gt;</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="n">lengths</span><span class="p">);</span>
</span><span id="__span-8-129"><a id="__codelineno-8-129" name="__codelineno-8-129" href="#__codelineno-8-129"></a>
</span><span id="__span-8-130"><a id="__codelineno-8-130" name="__codelineno-8-130" href="#__codelineno-8-130"></a><span class="w">        </span><span class="c1">// 比较结果</span>
</span><span id="__span-8-131"><a id="__codelineno-8-131" name="__codelineno-8-131" href="#__codelineno-8-131"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">result_hex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">md5_calc</span><span class="p">.</span><span class="n">hexdigest</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-8-132"><a id="__codelineno-8-132" name="__codelineno-8-132" href="#__codelineno-8-132"></a><span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">result_digest</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span><span id="__span-8-133"><a id="__codelineno-8-133" name="__codelineno-8-133" href="#__codelineno-8-133"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-134"><a id="__codelineno-8-134" name="__codelineno-8-134" href="#__codelineno-8-134"></a><span class="w">            </span><span class="n">parse_hex_digest</span><span class="p">(</span><span class="n">result_hex</span><span class="p">,</span><span class="w"> </span><span class="n">result_digest</span><span class="p">);</span>
</span><span id="__span-8-135"><a id="__codelineno-8-135" name="__codelineno-8-135" href="#__codelineno-8-135"></a><span class="w">            </span><span class="kt">bool</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-8-136"><a id="__codelineno-8-136" name="__codelineno-8-136" href="#__codelineno-8-136"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-137"><a id="__codelineno-8-137" name="__codelineno-8-137" href="#__codelineno-8-137"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result_digest</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">target_digest</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-138"><a id="__codelineno-8-138" name="__codelineno-8-138" href="#__codelineno-8-138"></a><span class="w">                    </span><span class="n">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-8-139"><a id="__codelineno-8-139" name="__codelineno-8-139" href="#__codelineno-8-139"></a><span class="w">                    </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-8-140"><a id="__codelineno-8-140" name="__codelineno-8-140" href="#__codelineno-8-140"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-8-141"><a id="__codelineno-8-141" name="__codelineno-8-141" href="#__codelineno-8-141"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-8-142"><a id="__codelineno-8-142" name="__codelineno-8-142" href="#__codelineno-8-142"></a>
</span><span id="__span-8-143"><a id="__codelineno-8-143" name="__codelineno-8-143" href="#__codelineno-8-143"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">match</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-144"><a id="__codelineno-8-144" name="__codelineno-8-144" href="#__codelineno-8-144"></a><span class="w">                </span><span class="c1">// 如果找到，就更新共享变量</span>
</span><span id="__span-8-145"><a id="__codelineno-8-145" name="__codelineno-8-145" href="#__codelineno-8-145"></a><span class="w">                </span><span class="c1">// 即使多个线程同时找到，这也能确保我们得到的是最小的n</span>
</span><span id="__span-8-146"><a id="__codelineno-8-146" name="__codelineno-8-146" href="#__codelineno-8-146"></a><span class="w">                </span><span class="cp">#pragma omp critical</span>
</span><span id="__span-8-147"><a id="__codelineno-8-147" name="__codelineno-8-147" href="#__codelineno-8-147"></a><span class="w">                </span><span class="p">{</span>
</span><span id="__span-8-148"><a id="__codelineno-8-148" name="__codelineno-8-148" href="#__codelineno-8-148"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">found_n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">found_n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-149"><a id="__codelineno-8-149" name="__codelineno-8-149" href="#__codelineno-8-149"></a><span class="w">                        </span><span class="n">found_n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
</span><span id="__span-8-150"><a id="__codelineno-8-150" name="__codelineno-8-150" href="#__codelineno-8-150"></a><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-8-151"><a id="__codelineno-8-151" name="__codelineno-8-151" href="#__codelineno-8-151"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-8-152"><a id="__codelineno-8-152" name="__codelineno-8-152" href="#__codelineno-8-152"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-8-153"><a id="__codelineno-8-153" name="__codelineno-8-153" href="#__codelineno-8-153"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-154"><a id="__codelineno-8-154" name="__codelineno-8-154" href="#__codelineno-8-154"></a><span class="w">            </span><span class="c1">// 忽略解析错误</span>
</span><span id="__span-8-155"><a id="__codelineno-8-155" name="__codelineno-8-155" href="#__codelineno-8-155"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-8-156"><a id="__codelineno-8-156" name="__codelineno-8-156" href="#__codelineno-8-156"></a>
</span><span id="__span-8-157"><a id="__codelineno-8-157" name="__codelineno-8-157" href="#__codelineno-8-157"></a><span class="w">        </span><span class="c1">// 为了跳到下一个属于本线程的任务，需要将生成器状态推进 (num_threads - 1) 次</span>
</span><span id="__span-8-158"><a id="__codelineno-8-158" name="__codelineno-8-158" href="#__codelineno-8-158"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">num_threads</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-159"><a id="__codelineno-8-159" name="__codelineno-8-159" href="#__codelineno-8-159"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">num_threads</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-160"><a id="__codelineno-8-160" name="__codelineno-8-160" href="#__codelineno-8-160"></a><span class="w">                </span><span class="n">generator</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="n">dummy_buffer</span><span class="p">);</span>
</span><span id="__span-8-161"><a id="__codelineno-8-161" name="__codelineno-8-161" href="#__codelineno-8-161"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-8-162"><a id="__codelineno-8-162" name="__codelineno-8-162" href="#__codelineno-8-162"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-8-163"><a id="__codelineno-8-163" name="__codelineno-8-163" href="#__codelineno-8-163"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-164"><a id="__codelineno-8-164" name="__codelineno-8-164" href="#__codelineno-8-164"></a><span class="p">}</span>
</span><span id="__span-8-165"><a id="__codelineno-8-165" name="__codelineno-8-165" href="#__codelineno-8-165"></a>
</span><span id="__span-8-166"><a id="__codelineno-8-166" name="__codelineno-8-166" href="#__codelineno-8-166"></a><span class="c1">// 5. 输出结果</span>
</span><span id="__span-8-167"><a id="__codelineno-8-167" name="__codelineno-8-167" href="#__codelineno-8-167"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">found_n</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-168"><a id="__codelineno-8-168" name="__codelineno-8-168" href="#__codelineno-8-168"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">found_n</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-8-169"><a id="__codelineno-8-169" name="__codelineno-8-169" href="#__codelineno-8-169"></a><span class="p">}</span>
</span><span id="__span-8-170"><a id="__codelineno-8-170" name="__codelineno-8-170" href="#__codelineno-8-170"></a>
</span><span id="__span-8-171"><a id="__codelineno-8-171" name="__codelineno-8-171" href="#__codelineno-8-171"></a><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-8-172"><a id="__codelineno-8-172" name="__codelineno-8-172" href="#__codelineno-8-172"></a><span class="p">}</span>
</span></code></pre></div>
</details>
<p>Ver1.0是最基本的实现，分析一下可以发现有问题的部分有</p>
<ol>
<li>MD5 没有用到 SIMD 加速，使用SIMD可以获得最高16x的加速</li>
<li>每个线程都有自己的生成器实例，每个线程都会从第一个随机数开始一直生成到属于自己的md5计算部分，重复计算</li>
<li>随机数生成器没有用到 SIMD 加速</li>
</ol>
<p>经profiling，<code>RndGen</code>占用的时间和8路<code>SIMD</code>计算时间大致相当，<code>RndGen</code>不是可忽略的开销</p>
<p><code>RndGen</code>实际上是Xorshift随机数生成器的变种，而<code>Xorshift</code>在<code>GF(2)</code>上是线性的</p>
<p>因此可以将这个随机数生成过程用二元域<code>GF(2)</code>上的矩阵乘法表示（<code>XOR</code>相当于乘法，<code>AND</code>相当于加法）</p>
<h3 id="rndgen">RndGen的数学表示<a class="headerlink" href="#rndgen" title="Permanent link">&para;</a></h3>
<ul>
<li>状态空间：</li>
</ul>
<div class="arithmatex">\[
\mathcal{S} = (\mathrm{GF}(2)^{64})^3
\]</div>
<ul>
<li>状态转移：</li>
</ul>
<div class="arithmatex">\[
(s_0,s_1,s_2) \;\mapsto\; (A s_0,\, A s_1,\, A s_2),
\]</div>
<p>其中:</p>
<div class="arithmatex">\[
A=(I \oplus L_{17})(I \oplus R_{7})(I \oplus L_{13})
\]</div>
<ul>
<li>输出函数：</li>
</ul>
<div class="arithmatex">\[
\text{Out}(s_0,s_1,s_2) = (A s_0,\,0,\,A s_1,\,0,\,A s_2,\,0).
\]</div>
<p>这个性质可以被利用于线程快速跳过属于其他线程的<code>MD5</code>计算任务，只需预先计算好</p>
<div class="arithmatex">\[
T = A^{\text{BATCH}  \times  \text{thread\_num}}
\]</div>
<p>将<span class="arithmatex">\(T\)</span>与当前状态相乘，即可在<code>O(1)</code>内完成跳到属于当前线程的<code>BATCH</code></p>
<p>这个算法名字叫<code>Xorshift Jump</code></p>
<details class="note">
<summary>RndGen</summary>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">RndGen</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="n">RndGen</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s0</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s1</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">        </span><span class="n">state_vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_setr_epi64</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span><span class="w"> </span><span class="n">s1</span><span class="p">,</span><span class="w"> </span><span class="n">s2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">generate</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">        </span><span class="n">update_state</span><span class="p">();</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">        </span><span class="k">alignas</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">temp</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">        </span><span class="n">_mm512_store_epi64</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">state_vec</span><span class="p">);</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">        </span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">        </span><span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">        </span><span class="n">out</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">generate_batch</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">out</span><span class="p">[][</span><span class="mi">6</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">            </span><span class="n">update_state</span><span class="p">();</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">            </span><span class="k">alignas</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">temp</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">            </span><span class="n">_mm512_store_epi64</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">state_vec</span><span class="p">);</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">            </span><span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">            </span><span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="w">            </span><span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">apply_bitmask_jump</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">BitMaskJump</span><span class="o">&amp;</span><span class="w"> </span><span class="n">jump_mask</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="w">        </span><span class="k">alignas</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">temp</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="w">        </span><span class="n">_mm512_store_epi64</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">state_vec</span><span class="p">);</span>
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">lane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">lane</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">lane</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="w">            </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">new_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">bit</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">64</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">bit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">lane</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="mi">1ULL</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">bit</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="w">                    </span><span class="n">new_val</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="n">jump_mask</span><span class="p">.</span><span class="n">masks</span><span class="p">[</span><span class="n">bit</span><span class="p">];</span>
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a><span class="w">            </span><span class="n">temp</span><span class="p">[</span><span class="n">lane</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_val</span><span class="p">;</span>
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a><span class="w">        </span><span class="n">state_vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_load_epi64</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a><span class="k">private</span><span class="o">:</span>
</span><span id="__span-9-45"><a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a><span class="w">    </span><span class="n">__m512i</span><span class="w"> </span><span class="n">state_vec</span><span class="p">;</span>
</span><span id="__span-9-46"><a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a>
</span><span id="__span-9-47"><a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a><span class="w">    </span><span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">update_state</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-48"><a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a><span class="w">        </span><span class="n">__m512i</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state_vec</span><span class="p">;</span>
</span><span id="__span-9-49"><a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a><span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_slli_epi64</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">));</span>
</span><span id="__span-9-50"><a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a><span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_srli_epi64</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">));</span>
</span><span id="__span-9-51"><a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a><span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_slli_epi64</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="p">));</span>
</span><span id="__span-9-52"><a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a><span class="w">        </span><span class="n">state_vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-9-53"><a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-54"><a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a><span class="p">};</span>
</span><span id="__span-9-55"><a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a>
</span><span id="__span-9-56"><a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a><span class="kt">void</span><span class="w"> </span><span class="nf">apply_precomputed_jump</span><span class="p">(</span><span class="n">RndGen</span><span class="o">&amp;</span><span class="w"> </span><span class="n">generator</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">jump_index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-57"><a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jump_index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">jump_index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-58"><a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a><span class="w">        </span><span class="n">generator</span><span class="p">.</span><span class="n">apply_bitmask_jump</span><span class="p">(</span><span class="n">PRECOMPUTED_JUMPS</span><span class="p">[</span><span class="n">jump_index</span><span class="p">]);</span>
</span><span id="__span-9-59"><a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-60"><a id="__codelineno-9-60" name="__codelineno-9-60" href="#__codelineno-9-60"></a><span class="p">}</span>
</span></code></pre></div>
</details>
<p>其中<code>PRECOMPUTED_JUMPS</code>是40个已经在编译前计算好的用于跳转到对应起始位置的掩码</p>
<div class="chat-container">  <div class="chat-message chat-left">
                    <img src="https://avatars.githubusercontent.com/u/191038400" class="chat-avatar" alt="Avatar">
                    <div class="chat-bubble">
                    流离流离，你这个随机数生成器虽然好，但是不是有点浪费了？
                    </div>
                </div>  <div class="chat-message chat-right">
                    <img src="https://avatars.githubusercontent.com/u/88608708" class="chat-avatar" alt="Avatar">
                    <div class="chat-bubble">
                    确实确实，向量寄存器都还没满呢，而且还需要转置才能传递给 MD5 计算实例
                    </div>
                </div></div>

<p>我们同样可以使用 <code>Xorshift Jump</code> 对SIMD操作进行并行优化，AVX512 的向量寄存器，最多能存储8个 <code>u64</code> 的状态，而使用 AVX512 向量的 MD5 实例一次计算需要 <span class="arithmatex">\(16 \times 3\)</span> 个状态，因此我们通过 6 个向量在一个 <code>RndGen</code> 对象里储存 16 组状态，一组状态由三个 <code>u64</code>状态共 24bytes 组成</p>
<p>如果我们之前是在同一个向量寄存器里储存同一组状态，那这个优化就相当于把同一组状态转置分散在三个不同向量寄存器里，刚好 MD5 实例计算所需要的就是这样转置后的 <code>SoA</code> 排列的状态，我们相当于同时做了两组优化：simd 加速随机数计算，同时节省了转置的操作开销</p>
<p>总结一下我们的并行策略:</p>
<ul>
<li>我们设定一个计算最小单元 <code>BLOCK</code> 为 8192 次迭代</li>
<li>首先通过 40 个线程在线程级别并行，每个线程之间状态相差 <span class="arithmatex">\(8192 \times 16\)</span> 组状态，即 16 个 BLOCK</li>
<li>线程内部通过 SIMD 并行，同时计算 16 组状态，每组状态之间相差一个 BLOCK</li>
<li>当线程迭代 8192 次后，本批次任务就完成了，此时使用 Xorshift 跳过其他线程负责的 BLOCK，来到下一个自己负责的批次</li>
</ul>
<p>多线程加上 8 路 SIMD 并行，理论上能比逐个计算快 <code>8 × 线程数</code> 倍</p>
<p>经过火焰图查看，我们的 MD5 计算占比从 50% 提升到了 90%，可喜可贺可喜可贺</p>
<details class="note">
<summary>最终优化代码 (270.2pts)</summary>
<div class="language-c++ highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;table.h&quot;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdint&gt;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdio&gt;</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstring&gt;</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;immintrin.h&gt;</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;omp.h&gt;</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdexcept&gt;</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="k">using</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__m512i</span><span class="p">;</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">RndGen</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">  </span><span class="n">RndGen</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s0</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s1</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">base_s0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s0</span><span class="p">;</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">base_s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="p">;</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">base_s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s2</span><span class="p">;</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="w">        </span><span class="n">s0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apply_jump_to_state_scalar</span><span class="p">(</span><span class="n">base_s0</span><span class="p">,</span><span class="w"> </span><span class="n">TRANSPOSED_JUMPS</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">        </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apply_jump_to_state_scalar</span><span class="p">(</span><span class="n">base_s1</span><span class="p">,</span><span class="w"> </span><span class="n">TRANSPOSED_JUMPS</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="w">        </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apply_jump_to_state_scalar</span><span class="p">(</span><span class="n">base_s2</span><span class="p">,</span><span class="w"> </span><span class="n">TRANSPOSED_JUMPS</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a><span class="w">      </span><span class="c1">// 应用跳转</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="w">      </span><span class="c1">// 存储状态</span>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a><span class="w">      </span><span class="n">s0_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s0</span><span class="p">;</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="w">      </span><span class="n">s1_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="p">;</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a><span class="w">      </span><span class="n">s2_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s2</span><span class="p">;</span>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="w">    </span><span class="c1">// 将状态加载到AVX512向量中</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a><span class="w">    </span><span class="n">load_states_to_vectors</span><span class="p">();</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a><span class="w">  </span><span class="c1">// 重载版本：使用预定义的跳转索引</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">jump_all_states_with_index</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">jump_index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jump_index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a><span class="w">    </span><span class="c1">// 将向量状态保存回数组，以便标量处理</span>
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a><span class="w">    </span><span class="n">save_vectors_to_states</span><span class="p">();</span>
</span><span id="__span-10-42"><a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a>
</span><span id="__span-10-43"><a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a><span class="w">    </span><span class="c1">// 对每个状态应用指定的跳转</span>
</span><span id="__span-10-44"><a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-45"><a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a><span class="w">      </span><span class="n">s0_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apply_jump_to_state_scalar</span><span class="p">(</span><span class="n">s0_states</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="__span-10-46"><a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a><span class="w">                                                </span><span class="n">TRANSPOSED_JUMPS</span><span class="p">[</span><span class="n">jump_index</span><span class="p">]);</span>
</span><span id="__span-10-47"><a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a><span class="w">      </span><span class="n">s1_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apply_jump_to_state_scalar</span><span class="p">(</span><span class="n">s1_states</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="__span-10-48"><a id="__codelineno-10-48" name="__codelineno-10-48" href="#__codelineno-10-48"></a><span class="w">                                                </span><span class="n">TRANSPOSED_JUMPS</span><span class="p">[</span><span class="n">jump_index</span><span class="p">]);</span>
</span><span id="__span-10-49"><a id="__codelineno-10-49" name="__codelineno-10-49" href="#__codelineno-10-49"></a><span class="w">      </span><span class="n">s2_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apply_jump_to_state_scalar</span><span class="p">(</span><span class="n">s2_states</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span id="__span-10-50"><a id="__codelineno-10-50" name="__codelineno-10-50" href="#__codelineno-10-50"></a><span class="w">                                                </span><span class="n">TRANSPOSED_JUMPS</span><span class="p">[</span><span class="n">jump_index</span><span class="p">]);</span>
</span><span id="__span-10-51"><a id="__codelineno-10-51" name="__codelineno-10-51" href="#__codelineno-10-51"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-52"><a id="__codelineno-10-52" name="__codelineno-10-52" href="#__codelineno-10-52"></a>
</span><span id="__span-10-53"><a id="__codelineno-10-53" name="__codelineno-10-53" href="#__codelineno-10-53"></a><span class="w">    </span><span class="c1">// 重新加载到向量中</span>
</span><span id="__span-10-54"><a id="__codelineno-10-54" name="__codelineno-10-54" href="#__codelineno-10-54"></a><span class="w">    </span><span class="n">load_states_to_vectors</span><span class="p">();</span>
</span><span id="__span-10-55"><a id="__codelineno-10-55" name="__codelineno-10-55" href="#__codelineno-10-55"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-56"><a id="__codelineno-10-56" name="__codelineno-10-56" href="#__codelineno-10-56"></a>
</span><span id="__span-10-57"><a id="__codelineno-10-57" name="__codelineno-10-57" href="#__codelineno-10-57"></a><span class="w">  </span><span class="c1">// 存储16个状态的数组</span>
</span><span id="__span-10-58"><a id="__codelineno-10-58" name="__codelineno-10-58" href="#__codelineno-10-58"></a><span class="w">  </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s0_states</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
</span><span id="__span-10-59"><a id="__codelineno-10-59" name="__codelineno-10-59" href="#__codelineno-10-59"></a><span class="w">  </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s1_states</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
</span><span id="__span-10-60"><a id="__codelineno-10-60" name="__codelineno-10-60" href="#__codelineno-10-60"></a><span class="w">  </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s2_states</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
</span><span id="__span-10-61"><a id="__codelineno-10-61" name="__codelineno-10-61" href="#__codelineno-10-61"></a>
</span><span id="__span-10-62"><a id="__codelineno-10-62" name="__codelineno-10-62" href="#__codelineno-10-62"></a><span class="w">  </span><span class="c1">// AVX512向量存储状态（使用两个向量处理16个状态）</span>
</span><span id="__span-10-63"><a id="__codelineno-10-63" name="__codelineno-10-63" href="#__codelineno-10-63"></a><span class="w">  </span><span class="n">__m512i</span><span class="w"> </span><span class="n">vec_s0_lo</span><span class="p">,</span><span class="w"> </span><span class="n">vec_s0_hi</span><span class="p">;</span>
</span><span id="__span-10-64"><a id="__codelineno-10-64" name="__codelineno-10-64" href="#__codelineno-10-64"></a><span class="w">  </span><span class="n">__m512i</span><span class="w"> </span><span class="n">vec_s1_lo</span><span class="p">,</span><span class="w"> </span><span class="n">vec_s1_hi</span><span class="p">;</span>
</span><span id="__span-10-65"><a id="__codelineno-10-65" name="__codelineno-10-65" href="#__codelineno-10-65"></a><span class="w">  </span><span class="n">__m512i</span><span class="w"> </span><span class="n">vec_s2_lo</span><span class="p">,</span><span class="w"> </span><span class="n">vec_s2_hi</span><span class="p">;</span>
</span><span id="__span-10-66"><a id="__codelineno-10-66" name="__codelineno-10-66" href="#__codelineno-10-66"></a>
</span><span id="__span-10-67"><a id="__codelineno-10-67" name="__codelineno-10-67" href="#__codelineno-10-67"></a><span class="w">  </span><span class="c1">// 将状态数组加载到AVX512向量中</span>
</span><span id="__span-10-68"><a id="__codelineno-10-68" name="__codelineno-10-68" href="#__codelineno-10-68"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">load_states_to_vectors</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-69"><a id="__codelineno-10-69" name="__codelineno-10-69" href="#__codelineno-10-69"></a><span class="w">    </span><span class="n">vec_s0_lo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_loadu_si512</span><span class="p">((</span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">s0_states</span><span class="p">);</span>
</span><span id="__span-10-70"><a id="__codelineno-10-70" name="__codelineno-10-70" href="#__codelineno-10-70"></a><span class="w">    </span><span class="n">vec_s0_hi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_loadu_si512</span><span class="p">((</span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s0_states</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">));</span>
</span><span id="__span-10-71"><a id="__codelineno-10-71" name="__codelineno-10-71" href="#__codelineno-10-71"></a><span class="w">    </span><span class="n">vec_s1_lo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_loadu_si512</span><span class="p">((</span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">s1_states</span><span class="p">);</span>
</span><span id="__span-10-72"><a id="__codelineno-10-72" name="__codelineno-10-72" href="#__codelineno-10-72"></a><span class="w">    </span><span class="n">vec_s1_hi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_loadu_si512</span><span class="p">((</span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s1_states</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">));</span>
</span><span id="__span-10-73"><a id="__codelineno-10-73" name="__codelineno-10-73" href="#__codelineno-10-73"></a><span class="w">    </span><span class="n">vec_s2_lo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_loadu_si512</span><span class="p">((</span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">s2_states</span><span class="p">);</span>
</span><span id="__span-10-74"><a id="__codelineno-10-74" name="__codelineno-10-74" href="#__codelineno-10-74"></a><span class="w">    </span><span class="n">vec_s2_hi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_loadu_si512</span><span class="p">((</span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s2_states</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">));</span>
</span><span id="__span-10-75"><a id="__codelineno-10-75" name="__codelineno-10-75" href="#__codelineno-10-75"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-76"><a id="__codelineno-10-76" name="__codelineno-10-76" href="#__codelineno-10-76"></a>
</span><span id="__span-10-77"><a id="__codelineno-10-77" name="__codelineno-10-77" href="#__codelineno-10-77"></a><span class="w">  </span><span class="c1">// 将AVX512向量保存回状态数组</span>
</span><span id="__span-10-78"><a id="__codelineno-10-78" name="__codelineno-10-78" href="#__codelineno-10-78"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">save_vectors_to_states</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-79"><a id="__codelineno-10-79" name="__codelineno-10-79" href="#__codelineno-10-79"></a><span class="w">    </span><span class="n">_mm512_storeu_si512</span><span class="p">((</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">s0_states</span><span class="p">,</span><span class="w"> </span><span class="n">vec_s0_lo</span><span class="p">);</span>
</span><span id="__span-10-80"><a id="__codelineno-10-80" name="__codelineno-10-80" href="#__codelineno-10-80"></a><span class="w">    </span><span class="n">_mm512_storeu_si512</span><span class="p">((</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s0_states</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">vec_s0_hi</span><span class="p">);</span>
</span><span id="__span-10-81"><a id="__codelineno-10-81" name="__codelineno-10-81" href="#__codelineno-10-81"></a><span class="w">    </span><span class="n">_mm512_storeu_si512</span><span class="p">((</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">s1_states</span><span class="p">,</span><span class="w"> </span><span class="n">vec_s1_lo</span><span class="p">);</span>
</span><span id="__span-10-82"><a id="__codelineno-10-82" name="__codelineno-10-82" href="#__codelineno-10-82"></a><span class="w">    </span><span class="n">_mm512_storeu_si512</span><span class="p">((</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s1_states</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">vec_s1_hi</span><span class="p">);</span>
</span><span id="__span-10-83"><a id="__codelineno-10-83" name="__codelineno-10-83" href="#__codelineno-10-83"></a><span class="w">    </span><span class="n">_mm512_storeu_si512</span><span class="p">((</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">s2_states</span><span class="p">,</span><span class="w"> </span><span class="n">vec_s2_lo</span><span class="p">);</span>
</span><span id="__span-10-84"><a id="__codelineno-10-84" name="__codelineno-10-84" href="#__codelineno-10-84"></a><span class="w">    </span><span class="n">_mm512_storeu_si512</span><span class="p">((</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)(</span><span class="n">s2_states</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">vec_s2_hi</span><span class="p">);</span>
</span><span id="__span-10-85"><a id="__codelineno-10-85" name="__codelineno-10-85" href="#__codelineno-10-85"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-86"><a id="__codelineno-10-86" name="__codelineno-10-86" href="#__codelineno-10-86"></a>
</span><span id="__span-10-87"><a id="__codelineno-10-87" name="__codelineno-10-87" href="#__codelineno-10-87"></a><span class="w">  </span><span class="c1">// AVX512版本的状态更新函数</span>
</span><span id="__span-10-88"><a id="__codelineno-10-88" name="__codelineno-10-88" href="#__codelineno-10-88"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">update_states_avx512</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-89"><a id="__codelineno-10-89" name="__codelineno-10-89" href="#__codelineno-10-89"></a><span class="w">    </span><span class="c1">// xorshift64操作 - 使用AVX512指令</span>
</span><span id="__span-10-90"><a id="__codelineno-10-90" name="__codelineno-10-90" href="#__codelineno-10-90"></a><span class="w">    </span><span class="n">__m512i</span><span class="w"> </span><span class="n">shift13</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_set1_epi64</span><span class="p">(</span><span class="mi">13</span><span class="p">);</span>
</span><span id="__span-10-91"><a id="__codelineno-10-91" name="__codelineno-10-91" href="#__codelineno-10-91"></a><span class="w">    </span><span class="n">__m512i</span><span class="w"> </span><span class="n">shift7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_set1_epi64</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
</span><span id="__span-10-92"><a id="__codelineno-10-92" name="__codelineno-10-92" href="#__codelineno-10-92"></a><span class="w">    </span><span class="n">__m512i</span><span class="w"> </span><span class="n">shift17</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_set1_epi64</span><span class="p">(</span><span class="mi">17</span><span class="p">);</span>
</span><span id="__span-10-93"><a id="__codelineno-10-93" name="__codelineno-10-93" href="#__codelineno-10-93"></a>
</span><span id="__span-10-94"><a id="__codelineno-10-94" name="__codelineno-10-94" href="#__codelineno-10-94"></a><span class="w">    </span><span class="c1">// 更新 vec_s0_lo</span>
</span><span id="__span-10-95"><a id="__codelineno-10-95" name="__codelineno-10-95" href="#__codelineno-10-95"></a><span class="w">    </span><span class="n">vec_s0_lo</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-96"><a id="__codelineno-10-96" name="__codelineno-10-96" href="#__codelineno-10-96"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s0_lo</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_sllv_epi64</span><span class="p">(</span><span class="n">vec_s0_lo</span><span class="p">,</span><span class="w"> </span><span class="n">shift13</span><span class="p">));</span>
</span><span id="__span-10-97"><a id="__codelineno-10-97" name="__codelineno-10-97" href="#__codelineno-10-97"></a><span class="w">    </span><span class="n">vec_s0_lo</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-98"><a id="__codelineno-10-98" name="__codelineno-10-98" href="#__codelineno-10-98"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s0_lo</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_srlv_epi64</span><span class="p">(</span><span class="n">vec_s0_lo</span><span class="p">,</span><span class="w"> </span><span class="n">shift7</span><span class="p">));</span>
</span><span id="__span-10-99"><a id="__codelineno-10-99" name="__codelineno-10-99" href="#__codelineno-10-99"></a><span class="w">    </span><span class="n">vec_s0_lo</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-100"><a id="__codelineno-10-100" name="__codelineno-10-100" href="#__codelineno-10-100"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s0_lo</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_sllv_epi64</span><span class="p">(</span><span class="n">vec_s0_lo</span><span class="p">,</span><span class="w"> </span><span class="n">shift17</span><span class="p">));</span>
</span><span id="__span-10-101"><a id="__codelineno-10-101" name="__codelineno-10-101" href="#__codelineno-10-101"></a>
</span><span id="__span-10-102"><a id="__codelineno-10-102" name="__codelineno-10-102" href="#__codelineno-10-102"></a><span class="w">    </span><span class="c1">// 更新 vec_s0_hi</span>
</span><span id="__span-10-103"><a id="__codelineno-10-103" name="__codelineno-10-103" href="#__codelineno-10-103"></a><span class="w">    </span><span class="n">vec_s0_hi</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-104"><a id="__codelineno-10-104" name="__codelineno-10-104" href="#__codelineno-10-104"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s0_hi</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_sllv_epi64</span><span class="p">(</span><span class="n">vec_s0_hi</span><span class="p">,</span><span class="w"> </span><span class="n">shift13</span><span class="p">));</span>
</span><span id="__span-10-105"><a id="__codelineno-10-105" name="__codelineno-10-105" href="#__codelineno-10-105"></a><span class="w">    </span><span class="n">vec_s0_hi</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-106"><a id="__codelineno-10-106" name="__codelineno-10-106" href="#__codelineno-10-106"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s0_hi</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_srlv_epi64</span><span class="p">(</span><span class="n">vec_s0_hi</span><span class="p">,</span><span class="w"> </span><span class="n">shift7</span><span class="p">));</span>
</span><span id="__span-10-107"><a id="__codelineno-10-107" name="__codelineno-10-107" href="#__codelineno-10-107"></a><span class="w">    </span><span class="n">vec_s0_hi</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-108"><a id="__codelineno-10-108" name="__codelineno-10-108" href="#__codelineno-10-108"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s0_hi</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_sllv_epi64</span><span class="p">(</span><span class="n">vec_s0_hi</span><span class="p">,</span><span class="w"> </span><span class="n">shift17</span><span class="p">));</span>
</span><span id="__span-10-109"><a id="__codelineno-10-109" name="__codelineno-10-109" href="#__codelineno-10-109"></a>
</span><span id="__span-10-110"><a id="__codelineno-10-110" name="__codelineno-10-110" href="#__codelineno-10-110"></a><span class="w">    </span><span class="c1">// 更新 vec_s1_lo</span>
</span><span id="__span-10-111"><a id="__codelineno-10-111" name="__codelineno-10-111" href="#__codelineno-10-111"></a><span class="w">    </span><span class="n">vec_s1_lo</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-112"><a id="__codelineno-10-112" name="__codelineno-10-112" href="#__codelineno-10-112"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s1_lo</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_sllv_epi64</span><span class="p">(</span><span class="n">vec_s1_lo</span><span class="p">,</span><span class="w"> </span><span class="n">shift13</span><span class="p">));</span>
</span><span id="__span-10-113"><a id="__codelineno-10-113" name="__codelineno-10-113" href="#__codelineno-10-113"></a><span class="w">    </span><span class="n">vec_s1_lo</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-114"><a id="__codelineno-10-114" name="__codelineno-10-114" href="#__codelineno-10-114"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s1_lo</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_srlv_epi64</span><span class="p">(</span><span class="n">vec_s1_lo</span><span class="p">,</span><span class="w"> </span><span class="n">shift7</span><span class="p">));</span>
</span><span id="__span-10-115"><a id="__codelineno-10-115" name="__codelineno-10-115" href="#__codelineno-10-115"></a><span class="w">    </span><span class="n">vec_s1_lo</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-116"><a id="__codelineno-10-116" name="__codelineno-10-116" href="#__codelineno-10-116"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s1_lo</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_sllv_epi64</span><span class="p">(</span><span class="n">vec_s1_lo</span><span class="p">,</span><span class="w"> </span><span class="n">shift17</span><span class="p">));</span>
</span><span id="__span-10-117"><a id="__codelineno-10-117" name="__codelineno-10-117" href="#__codelineno-10-117"></a>
</span><span id="__span-10-118"><a id="__codelineno-10-118" name="__codelineno-10-118" href="#__codelineno-10-118"></a><span class="w">    </span><span class="c1">// 更新 vec_s1_hi</span>
</span><span id="__span-10-119"><a id="__codelineno-10-119" name="__codelineno-10-119" href="#__codelineno-10-119"></a><span class="w">    </span><span class="n">vec_s1_hi</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-120"><a id="__codelineno-10-120" name="__codelineno-10-120" href="#__codelineno-10-120"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s1_hi</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_sllv_epi64</span><span class="p">(</span><span class="n">vec_s1_hi</span><span class="p">,</span><span class="w"> </span><span class="n">shift13</span><span class="p">));</span>
</span><span id="__span-10-121"><a id="__codelineno-10-121" name="__codelineno-10-121" href="#__codelineno-10-121"></a><span class="w">    </span><span class="n">vec_s1_hi</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-122"><a id="__codelineno-10-122" name="__codelineno-10-122" href="#__codelineno-10-122"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s1_hi</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_srlv_epi64</span><span class="p">(</span><span class="n">vec_s1_hi</span><span class="p">,</span><span class="w"> </span><span class="n">shift7</span><span class="p">));</span>
</span><span id="__span-10-123"><a id="__codelineno-10-123" name="__codelineno-10-123" href="#__codelineno-10-123"></a><span class="w">    </span><span class="n">vec_s1_hi</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-124"><a id="__codelineno-10-124" name="__codelineno-10-124" href="#__codelineno-10-124"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s1_hi</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_sllv_epi64</span><span class="p">(</span><span class="n">vec_s1_hi</span><span class="p">,</span><span class="w"> </span><span class="n">shift17</span><span class="p">));</span>
</span><span id="__span-10-125"><a id="__codelineno-10-125" name="__codelineno-10-125" href="#__codelineno-10-125"></a>
</span><span id="__span-10-126"><a id="__codelineno-10-126" name="__codelineno-10-126" href="#__codelineno-10-126"></a><span class="w">    </span><span class="c1">// 更新 vec_s2_lo</span>
</span><span id="__span-10-127"><a id="__codelineno-10-127" name="__codelineno-10-127" href="#__codelineno-10-127"></a><span class="w">    </span><span class="n">vec_s2_lo</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-128"><a id="__codelineno-10-128" name="__codelineno-10-128" href="#__codelineno-10-128"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s2_lo</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_sllv_epi64</span><span class="p">(</span><span class="n">vec_s2_lo</span><span class="p">,</span><span class="w"> </span><span class="n">shift13</span><span class="p">));</span>
</span><span id="__span-10-129"><a id="__codelineno-10-129" name="__codelineno-10-129" href="#__codelineno-10-129"></a><span class="w">    </span><span class="n">vec_s2_lo</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-130"><a id="__codelineno-10-130" name="__codelineno-10-130" href="#__codelineno-10-130"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s2_lo</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_srlv_epi64</span><span class="p">(</span><span class="n">vec_s2_lo</span><span class="p">,</span><span class="w"> </span><span class="n">shift7</span><span class="p">));</span>
</span><span id="__span-10-131"><a id="__codelineno-10-131" name="__codelineno-10-131" href="#__codelineno-10-131"></a><span class="w">    </span><span class="n">vec_s2_lo</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-132"><a id="__codelineno-10-132" name="__codelineno-10-132" href="#__codelineno-10-132"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s2_lo</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_sllv_epi64</span><span class="p">(</span><span class="n">vec_s2_lo</span><span class="p">,</span><span class="w"> </span><span class="n">shift17</span><span class="p">));</span>
</span><span id="__span-10-133"><a id="__codelineno-10-133" name="__codelineno-10-133" href="#__codelineno-10-133"></a>
</span><span id="__span-10-134"><a id="__codelineno-10-134" name="__codelineno-10-134" href="#__codelineno-10-134"></a><span class="w">    </span><span class="c1">// 更新 vec_s2_hi</span>
</span><span id="__span-10-135"><a id="__codelineno-10-135" name="__codelineno-10-135" href="#__codelineno-10-135"></a><span class="w">    </span><span class="n">vec_s2_hi</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-136"><a id="__codelineno-10-136" name="__codelineno-10-136" href="#__codelineno-10-136"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s2_hi</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_sllv_epi64</span><span class="p">(</span><span class="n">vec_s2_hi</span><span class="p">,</span><span class="w"> </span><span class="n">shift13</span><span class="p">));</span>
</span><span id="__span-10-137"><a id="__codelineno-10-137" name="__codelineno-10-137" href="#__codelineno-10-137"></a><span class="w">    </span><span class="n">vec_s2_hi</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-138"><a id="__codelineno-10-138" name="__codelineno-10-138" href="#__codelineno-10-138"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s2_hi</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_srlv_epi64</span><span class="p">(</span><span class="n">vec_s2_hi</span><span class="p">,</span><span class="w"> </span><span class="n">shift7</span><span class="p">));</span>
</span><span id="__span-10-139"><a id="__codelineno-10-139" name="__codelineno-10-139" href="#__codelineno-10-139"></a><span class="w">    </span><span class="n">vec_s2_hi</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-140"><a id="__codelineno-10-140" name="__codelineno-10-140" href="#__codelineno-10-140"></a><span class="w">        </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">vec_s2_hi</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_sllv_epi64</span><span class="p">(</span><span class="n">vec_s2_hi</span><span class="p">,</span><span class="w"> </span><span class="n">shift17</span><span class="p">));</span>
</span><span id="__span-10-141"><a id="__codelineno-10-141" name="__codelineno-10-141" href="#__codelineno-10-141"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-142"><a id="__codelineno-10-142" name="__codelineno-10-142" href="#__codelineno-10-142"></a>
</span><span id="__span-10-143"><a id="__codelineno-10-143" name="__codelineno-10-143" href="#__codelineno-10-143"></a><span class="w">  </span><span class="c1">// 标量版本的跳转应用函数</span>
</span><span id="__span-10-144"><a id="__codelineno-10-144" name="__codelineno-10-144" href="#__codelineno-10-144"></a><span class="w">  </span><span class="kt">uint64_t</span><span class="w"> </span><span class="nf">apply_jump_to_state_scalar</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">state</span><span class="p">,</span>
</span><span id="__span-10-145"><a id="__codelineno-10-145" name="__codelineno-10-145" href="#__codelineno-10-145"></a><span class="w">                                      </span><span class="k">const</span><span class="w"> </span><span class="n">TransposedBitMaskJump</span><span class="w"> </span><span class="o">&amp;</span><span class="n">jump_mask</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-146"><a id="__codelineno-10-146" name="__codelineno-10-146" href="#__codelineno-10-146"></a><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-10-147"><a id="__codelineno-10-147" name="__codelineno-10-147" href="#__codelineno-10-147"></a>
</span><span id="__span-10-148"><a id="__codelineno-10-148" name="__codelineno-10-148" href="#__codelineno-10-148"></a><span class="w">    </span><span class="c1">// 处理8个列块（每个块8列）</span>
</span><span id="__span-10-149"><a id="__codelineno-10-149" name="__codelineno-10-149" href="#__codelineno-10-149"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">block</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-150"><a id="__codelineno-10-150" name="__codelineno-10-150" href="#__codelineno-10-150"></a><span class="w">      </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">block_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-10-151"><a id="__codelineno-10-151" name="__codelineno-10-151" href="#__codelineno-10-151"></a>
</span><span id="__span-10-152"><a id="__codelineno-10-152" name="__codelineno-10-152" href="#__codelineno-10-152"></a><span class="w">      </span><span class="c1">// 处理块内的8列</span>
</span><span id="__span-10-153"><a id="__codelineno-10-153" name="__codelineno-10-153" href="#__codelineno-10-153"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">col_in_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">col_in_block</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">col_in_block</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-154"><a id="__codelineno-10-154" name="__codelineno-10-154" href="#__codelineno-10-154"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">col_in_block</span><span class="p">;</span>
</span><span id="__span-10-155"><a id="__codelineno-10-155" name="__codelineno-10-155" href="#__codelineno-10-155"></a><span class="w">        </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">col_mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jump_mask</span><span class="p">.</span><span class="n">T</span><span class="p">[</span><span class="n">col</span><span class="p">];</span>
</span><span id="__span-10-156"><a id="__codelineno-10-156" name="__codelineno-10-156" href="#__codelineno-10-156"></a>
</span><span id="__span-10-157"><a id="__codelineno-10-157" name="__codelineno-10-157" href="#__codelineno-10-157"></a><span class="w">        </span><span class="c1">// 计算 parity (popcount % 2)</span>
</span><span id="__span-10-158"><a id="__codelineno-10-158" name="__codelineno-10-158" href="#__codelineno-10-158"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">parity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__builtin_popcountll</span><span class="p">(</span><span class="n">col_mask</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-10-159"><a id="__codelineno-10-159" name="__codelineno-10-159" href="#__codelineno-10-159"></a><span class="w">        </span><span class="n">block_result</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint64_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">parity</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">col_in_block</span><span class="p">);</span>
</span><span id="__span-10-160"><a id="__codelineno-10-160" name="__codelineno-10-160" href="#__codelineno-10-160"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-10-161"><a id="__codelineno-10-161" name="__codelineno-10-161" href="#__codelineno-10-161"></a>
</span><span id="__span-10-162"><a id="__codelineno-10-162" name="__codelineno-10-162" href="#__codelineno-10-162"></a><span class="w">      </span><span class="n">result</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="n">block_result</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">block</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">8</span><span class="p">));</span>
</span><span id="__span-10-163"><a id="__codelineno-10-163" name="__codelineno-10-163" href="#__codelineno-10-163"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-164"><a id="__codelineno-10-164" name="__codelineno-10-164" href="#__codelineno-10-164"></a>
</span><span id="__span-10-165"><a id="__codelineno-10-165" name="__codelineno-10-165" href="#__codelineno-10-165"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
</span><span id="__span-10-166"><a id="__codelineno-10-166" name="__codelineno-10-166" href="#__codelineno-10-166"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-167"><a id="__codelineno-10-167" name="__codelineno-10-167" href="#__codelineno-10-167"></a><span class="p">};</span>
</span><span id="__span-10-168"><a id="__codelineno-10-168" name="__codelineno-10-168" href="#__codelineno-10-168"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">md5_avx512_soa</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-169"><a id="__codelineno-10-169" name="__codelineno-10-169" href="#__codelineno-10-169"></a>
</span><span id="__span-10-170"><a id="__codelineno-10-170" name="__codelineno-10-170" href="#__codelineno-10-170"></a><span class="k">class</span><span class="w"> </span><span class="nc">MD5</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-171"><a id="__codelineno-10-171" name="__codelineno-10-171" href="#__codelineno-10-171"></a><span class="k">public</span><span class="o">:</span>
</span><span id="__span-10-172"><a id="__codelineno-10-172" name="__codelineno-10-172" href="#__codelineno-10-172"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">HASH_COUNT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span>
</span><span id="__span-10-173"><a id="__codelineno-10-173" name="__codelineno-10-173" href="#__codelineno-10-173"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">BLOCK_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">64</span><span class="p">;</span>
</span><span id="__span-10-174"><a id="__codelineno-10-174" name="__codelineno-10-174" href="#__codelineno-10-174"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">WORDS_PER_BLOCK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BLOCK_SIZE</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">uint32_t</span><span class="p">);</span>
</span><span id="__span-10-175"><a id="__codelineno-10-175" name="__codelineno-10-175" href="#__codelineno-10-175"></a>
</span><span id="__span-10-176"><a id="__codelineno-10-176" name="__codelineno-10-176" href="#__codelineno-10-176"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">InputSoA</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-177"><a id="__codelineno-10-177" name="__codelineno-10-177" href="#__codelineno-10-177"></a><span class="w">    </span><span class="n">__reg</span><span class="w"> </span><span class="n">words</span><span class="p">[</span><span class="n">WORDS_PER_BLOCK</span><span class="p">];</span>
</span><span id="__span-10-178"><a id="__codelineno-10-178" name="__codelineno-10-178" href="#__codelineno-10-178"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-10-179"><a id="__codelineno-10-179" name="__codelineno-10-179" href="#__codelineno-10-179"></a>
</span><span id="__span-10-180"><a id="__codelineno-10-180" name="__codelineno-10-180" href="#__codelineno-10-180"></a><span class="w">  </span><span class="n">MD5</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-181"><a id="__codelineno-10-181" name="__codelineno-10-181" href="#__codelineno-10-181"></a><span class="w">    </span><span class="n">init</span><span class="p">();</span>
</span><span id="__span-10-182"><a id="__codelineno-10-182" name="__codelineno-10-182" href="#__codelineno-10-182"></a><span class="w">    </span><span class="n">reset</span><span class="p">();</span>
</span><span id="__span-10-183"><a id="__codelineno-10-183" name="__codelineno-10-183" href="#__codelineno-10-183"></a><span class="w">    </span><span class="n">target_digest_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_setzero_si512</span><span class="p">();</span>
</span><span id="__span-10-184"><a id="__codelineno-10-184" name="__codelineno-10-184" href="#__codelineno-10-184"></a><span class="w">    </span><span class="n">target_digest_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_setzero_si512</span><span class="p">();</span>
</span><span id="__span-10-185"><a id="__codelineno-10-185" name="__codelineno-10-185" href="#__codelineno-10-185"></a><span class="w">    </span><span class="n">target_digest_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_setzero_si512</span><span class="p">();</span>
</span><span id="__span-10-186"><a id="__codelineno-10-186" name="__codelineno-10-186" href="#__codelineno-10-186"></a><span class="w">    </span><span class="n">target_digest_d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_setzero_si512</span><span class="p">();</span>
</span><span id="__span-10-187"><a id="__codelineno-10-187" name="__codelineno-10-187" href="#__codelineno-10-187"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-188"><a id="__codelineno-10-188" name="__codelineno-10-188" href="#__codelineno-10-188"></a>
</span><span id="__span-10-189"><a id="__codelineno-10-189" name="__codelineno-10-189" href="#__codelineno-10-189"></a><span class="w">  </span><span class="n">MD5</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">MD5</span><span class="w"> </span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
</span><span id="__span-10-190"><a id="__codelineno-10-190" name="__codelineno-10-190" href="#__codelineno-10-190"></a><span class="w">  </span><span class="n">MD5</span><span class="p">(</span><span class="n">MD5</span><span class="w"> </span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
</span><span id="__span-10-191"><a id="__codelineno-10-191" name="__codelineno-10-191" href="#__codelineno-10-191"></a><span class="w">  </span><span class="n">MD5</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">MD5</span><span class="w"> </span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
</span><span id="__span-10-192"><a id="__codelineno-10-192" name="__codelineno-10-192" href="#__codelineno-10-192"></a><span class="w">  </span><span class="n">MD5</span><span class="p">(</span><span class="n">MD5</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
</span><span id="__span-10-193"><a id="__codelineno-10-193" name="__codelineno-10-193" href="#__codelineno-10-193"></a><span class="w">  </span><span class="n">MD5</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">MD5</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
</span><span id="__span-10-194"><a id="__codelineno-10-194" name="__codelineno-10-194" href="#__codelineno-10-194"></a>
</span><span id="__span-10-195"><a id="__codelineno-10-195" name="__codelineno-10-195" href="#__codelineno-10-195"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">set_target_digest</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">target</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-196"><a id="__codelineno-10-196" name="__codelineno-10-196" href="#__codelineno-10-196"></a><span class="w">    </span><span class="n">target_digest_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_set1_epi32</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span id="__span-10-197"><a id="__codelineno-10-197" name="__codelineno-10-197" href="#__codelineno-10-197"></a><span class="w">    </span><span class="n">target_digest_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_set1_epi32</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span id="__span-10-198"><a id="__codelineno-10-198" name="__codelineno-10-198" href="#__codelineno-10-198"></a><span class="w">    </span><span class="n">target_digest_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_set1_epi32</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">target</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span><span id="__span-10-199"><a id="__codelineno-10-199" name="__codelineno-10-199" href="#__codelineno-10-199"></a><span class="w">    </span><span class="n">target_digest_d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_set1_epi32</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">target</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
</span><span id="__span-10-200"><a id="__codelineno-10-200" name="__codelineno-10-200" href="#__codelineno-10-200"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-201"><a id="__codelineno-10-201" name="__codelineno-10-201" href="#__codelineno-10-201"></a>
</span><span id="__span-10-202"><a id="__codelineno-10-202" name="__codelineno-10-202" href="#__codelineno-10-202"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="nf">find_match_index</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-203"><a id="__codelineno-10-203" name="__codelineno-10-203" href="#__codelineno-10-203"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">finalized</span><span class="p">)</span>
</span><span id="__span-10-204"><a id="__codelineno-10-204" name="__codelineno-10-204" href="#__codelineno-10-204"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
</span><span id="__span-10-205"><a id="__codelineno-10-205" name="__codelineno-10-205" href="#__codelineno-10-205"></a><span class="w">    </span><span class="n">__mmask16</span><span class="w"> </span><span class="n">match_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_cmpeq_epi32_mask</span><span class="p">(</span><span class="n">digest_a</span><span class="p">,</span><span class="w"> </span><span class="n">target_digest_a</span><span class="p">);</span>
</span><span id="__span-10-206"><a id="__codelineno-10-206" name="__codelineno-10-206" href="#__codelineno-10-206"></a><span class="w">    </span><span class="n">__mmask16</span><span class="w"> </span><span class="n">match_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_cmpeq_epi32_mask</span><span class="p">(</span><span class="n">digest_b</span><span class="p">,</span><span class="w"> </span><span class="n">target_digest_b</span><span class="p">);</span>
</span><span id="__span-10-207"><a id="__codelineno-10-207" name="__codelineno-10-207" href="#__codelineno-10-207"></a><span class="w">    </span><span class="n">__mmask16</span><span class="w"> </span><span class="n">match_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_cmpeq_epi32_mask</span><span class="p">(</span><span class="n">digest_c</span><span class="p">,</span><span class="w"> </span><span class="n">target_digest_c</span><span class="p">);</span>
</span><span id="__span-10-208"><a id="__codelineno-10-208" name="__codelineno-10-208" href="#__codelineno-10-208"></a><span class="w">    </span><span class="n">__mmask16</span><span class="w"> </span><span class="n">match_d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_cmpeq_epi32_mask</span><span class="p">(</span><span class="n">digest_d</span><span class="p">,</span><span class="w"> </span><span class="n">target_digest_d</span><span class="p">);</span>
</span><span id="__span-10-209"><a id="__codelineno-10-209" name="__codelineno-10-209" href="#__codelineno-10-209"></a><span class="w">    </span><span class="n">__mmask16</span><span class="w"> </span><span class="n">all_match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">match_a</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">match_b</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">match_c</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">match_d</span><span class="p">;</span>
</span><span id="__span-10-210"><a id="__codelineno-10-210" name="__codelineno-10-210" href="#__codelineno-10-210"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">all_match</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-211"><a id="__codelineno-10-211" name="__codelineno-10-211" href="#__codelineno-10-211"></a><span class="w">      </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">bitmap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">all_match</span><span class="p">;</span>
</span><span id="__span-10-212"><a id="__codelineno-10-212" name="__codelineno-10-212" href="#__codelineno-10-212"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">_tzcnt_u32</span><span class="p">(</span><span class="n">bitmap</span><span class="p">);</span>
</span><span id="__span-10-213"><a id="__codelineno-10-213" name="__codelineno-10-213" href="#__codelineno-10-213"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-214"><a id="__codelineno-10-214" name="__codelineno-10-214" href="#__codelineno-10-214"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
</span><span id="__span-10-215"><a id="__codelineno-10-215" name="__codelineno-10-215" href="#__codelineno-10-215"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-216"><a id="__codelineno-10-216" name="__codelineno-10-216" href="#__codelineno-10-216"></a>
</span><span id="__span-10-217"><a id="__codelineno-10-217" name="__codelineno-10-217" href="#__codelineno-10-217"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">reset</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-218"><a id="__codelineno-10-218" name="__codelineno-10-218" href="#__codelineno-10-218"></a><span class="w">    </span><span class="n">finalized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-10-219"><a id="__codelineno-10-219" name="__codelineno-10-219" href="#__codelineno-10-219"></a><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_set1_epi32</span><span class="p">(</span><span class="mh">0x67452301</span><span class="p">);</span>
</span><span id="__span-10-220"><a id="__codelineno-10-220" name="__codelineno-10-220" href="#__codelineno-10-220"></a><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_set1_epi32</span><span class="p">(</span><span class="mh">0xefcdab89</span><span class="p">);</span>
</span><span id="__span-10-221"><a id="__codelineno-10-221" name="__codelineno-10-221" href="#__codelineno-10-221"></a><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_set1_epi32</span><span class="p">(</span><span class="mh">0x98badcfe</span><span class="p">);</span>
</span><span id="__span-10-222"><a id="__codelineno-10-222" name="__codelineno-10-222" href="#__codelineno-10-222"></a><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_set1_epi32</span><span class="p">(</span><span class="mh">0x10325476</span><span class="p">);</span>
</span><span id="__span-10-223"><a id="__codelineno-10-223" name="__codelineno-10-223" href="#__codelineno-10-223"></a><span class="w">    </span><span class="n">digest_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_setzero_si512</span><span class="p">();</span>
</span><span id="__span-10-224"><a id="__codelineno-10-224" name="__codelineno-10-224" href="#__codelineno-10-224"></a><span class="w">    </span><span class="n">digest_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_setzero_si512</span><span class="p">();</span>
</span><span id="__span-10-225"><a id="__codelineno-10-225" name="__codelineno-10-225" href="#__codelineno-10-225"></a><span class="w">    </span><span class="n">digest_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_setzero_si512</span><span class="p">();</span>
</span><span id="__span-10-226"><a id="__codelineno-10-226" name="__codelineno-10-226" href="#__codelineno-10-226"></a><span class="w">    </span><span class="n">digest_d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_setzero_si512</span><span class="p">();</span>
</span><span id="__span-10-227"><a id="__codelineno-10-227" name="__codelineno-10-227" href="#__codelineno-10-227"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-228"><a id="__codelineno-10-228" name="__codelineno-10-228" href="#__codelineno-10-228"></a>
</span><span id="__span-10-229"><a id="__codelineno-10-229" name="__codelineno-10-229" href="#__codelineno-10-229"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span><span class="n">RndGen</span><span class="w"> </span><span class="o">&amp;</span><span class="n">generator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-230"><a id="__codelineno-10-230" name="__codelineno-10-230" href="#__codelineno-10-230"></a><span class="w">    </span><span class="n">reset</span><span class="p">();</span>
</span><span id="__span-10-231"><a id="__codelineno-10-231" name="__codelineno-10-231" href="#__codelineno-10-231"></a><span class="w">    </span><span class="n">transform</span><span class="p">(</span><span class="n">generator</span><span class="p">);</span>
</span><span id="__span-10-232"><a id="__codelineno-10-232" name="__codelineno-10-232" href="#__codelineno-10-232"></a><span class="w">    </span><span class="n">finalize</span><span class="p">();</span>
</span><span id="__span-10-233"><a id="__codelineno-10-233" name="__codelineno-10-233" href="#__codelineno-10-233"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-234"><a id="__codelineno-10-234" name="__codelineno-10-234" href="#__codelineno-10-234"></a>
</span><span id="__span-10-235"><a id="__codelineno-10-235" name="__codelineno-10-235" href="#__codelineno-10-235"></a><span class="k">private</span><span class="o">:</span>
</span><span id="__span-10-236"><a id="__codelineno-10-236" name="__codelineno-10-236" href="#__codelineno-10-236"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-237"><a id="__codelineno-10-237" name="__codelineno-10-237" href="#__codelineno-10-237"></a><span class="w">    </span><span class="n">reset</span><span class="p">();</span>
</span><span id="__span-10-238"><a id="__codelineno-10-238" name="__codelineno-10-238" href="#__codelineno-10-238"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-239"><a id="__codelineno-10-239" name="__codelineno-10-239" href="#__codelineno-10-239"></a><span class="w">      </span><span class="n">kv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_set1_epi32</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="__span-10-240"><a id="__codelineno-10-240" name="__codelineno-10-240" href="#__codelineno-10-240"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-241"><a id="__codelineno-10-241" name="__codelineno-10-241" href="#__codelineno-10-241"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-242"><a id="__codelineno-10-242" name="__codelineno-10-242" href="#__codelineno-10-242"></a>
</span><span id="__span-10-243"><a id="__codelineno-10-243" name="__codelineno-10-243" href="#__codelineno-10-243"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">transform</span><span class="p">(</span><span class="n">RndGen</span><span class="w"> </span><span class="o">&amp;</span><span class="n">generator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-244"><a id="__codelineno-10-244" name="__codelineno-10-244" href="#__codelineno-10-244"></a><span class="w">    </span><span class="c1">// 更新随机数生成器状态</span>
</span><span id="__span-10-245"><a id="__codelineno-10-245" name="__codelineno-10-245" href="#__codelineno-10-245"></a><span class="w">    </span><span class="n">generator</span><span class="p">.</span><span class="n">update_states_avx512</span><span class="p">();</span>
</span><span id="__span-10-246"><a id="__codelineno-10-246" name="__codelineno-10-246" href="#__codelineno-10-246"></a>
</span><span id="__span-10-247"><a id="__codelineno-10-247" name="__codelineno-10-247" href="#__codelineno-10-247"></a><span class="w">    </span><span class="c1">// 直接提取并使用随机数，避免临时数组存储</span>
</span><span id="__span-10-248"><a id="__codelineno-10-248" name="__codelineno-10-248" href="#__codelineno-10-248"></a><span class="w">    </span><span class="n">__m256i</span><span class="w"> </span><span class="n">s0_lo_low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_cvtepi64_epi32</span><span class="p">(</span><span class="n">generator</span><span class="p">.</span><span class="n">vec_s0_lo</span><span class="p">);</span>
</span><span id="__span-10-249"><a id="__codelineno-10-249" name="__codelineno-10-249" href="#__codelineno-10-249"></a><span class="w">    </span><span class="n">__m256i</span><span class="w"> </span><span class="n">s0_hi_low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_cvtepi64_epi32</span><span class="p">(</span><span class="n">generator</span><span class="p">.</span><span class="n">vec_s0_hi</span><span class="p">);</span>
</span><span id="__span-10-250"><a id="__codelineno-10-250" name="__codelineno-10-250" href="#__codelineno-10-250"></a><span class="w">    </span><span class="n">__reg</span><span class="w"> </span><span class="n">x0</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-251"><a id="__codelineno-10-251" name="__codelineno-10-251" href="#__codelineno-10-251"></a><span class="w">        </span><span class="n">_mm512_inserti32x8</span><span class="p">(</span><span class="n">_mm512_castsi256_si512</span><span class="p">(</span><span class="n">s0_lo_low</span><span class="p">),</span><span class="w"> </span><span class="n">s0_hi_low</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-10-252"><a id="__codelineno-10-252" name="__codelineno-10-252" href="#__codelineno-10-252"></a>
</span><span id="__span-10-253"><a id="__codelineno-10-253" name="__codelineno-10-253" href="#__codelineno-10-253"></a><span class="w">    </span><span class="n">__m256i</span><span class="w"> </span><span class="n">s0_lo_high</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-254"><a id="__codelineno-10-254" name="__codelineno-10-254" href="#__codelineno-10-254"></a><span class="w">        </span><span class="n">_mm512_cvtepi64_epi32</span><span class="p">(</span><span class="n">_mm512_srli_epi64</span><span class="p">(</span><span class="n">generator</span><span class="p">.</span><span class="n">vec_s0_lo</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">));</span>
</span><span id="__span-10-255"><a id="__codelineno-10-255" name="__codelineno-10-255" href="#__codelineno-10-255"></a><span class="w">    </span><span class="n">__m256i</span><span class="w"> </span><span class="n">s0_hi_high</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-256"><a id="__codelineno-10-256" name="__codelineno-10-256" href="#__codelineno-10-256"></a><span class="w">        </span><span class="n">_mm512_cvtepi64_epi32</span><span class="p">(</span><span class="n">_mm512_srli_epi64</span><span class="p">(</span><span class="n">generator</span><span class="p">.</span><span class="n">vec_s0_hi</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">));</span>
</span><span id="__span-10-257"><a id="__codelineno-10-257" name="__codelineno-10-257" href="#__codelineno-10-257"></a><span class="w">    </span><span class="n">__reg</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-258"><a id="__codelineno-10-258" name="__codelineno-10-258" href="#__codelineno-10-258"></a><span class="w">        </span><span class="n">_mm512_inserti32x8</span><span class="p">(</span><span class="n">_mm512_castsi256_si512</span><span class="p">(</span><span class="n">s0_lo_high</span><span class="p">),</span><span class="w"> </span><span class="n">s0_hi_high</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-10-259"><a id="__codelineno-10-259" name="__codelineno-10-259" href="#__codelineno-10-259"></a>
</span><span id="__span-10-260"><a id="__codelineno-10-260" name="__codelineno-10-260" href="#__codelineno-10-260"></a><span class="w">    </span><span class="n">__m256i</span><span class="w"> </span><span class="n">s1_lo_low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_cvtepi64_epi32</span><span class="p">(</span><span class="n">generator</span><span class="p">.</span><span class="n">vec_s1_lo</span><span class="p">);</span>
</span><span id="__span-10-261"><a id="__codelineno-10-261" name="__codelineno-10-261" href="#__codelineno-10-261"></a><span class="w">    </span><span class="n">__m256i</span><span class="w"> </span><span class="n">s1_hi_low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_cvtepi64_epi32</span><span class="p">(</span><span class="n">generator</span><span class="p">.</span><span class="n">vec_s1_hi</span><span class="p">);</span>
</span><span id="__span-10-262"><a id="__codelineno-10-262" name="__codelineno-10-262" href="#__codelineno-10-262"></a><span class="w">    </span><span class="n">__reg</span><span class="w"> </span><span class="n">x4</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-263"><a id="__codelineno-10-263" name="__codelineno-10-263" href="#__codelineno-10-263"></a><span class="w">        </span><span class="n">_mm512_inserti32x8</span><span class="p">(</span><span class="n">_mm512_castsi256_si512</span><span class="p">(</span><span class="n">s1_lo_low</span><span class="p">),</span><span class="w"> </span><span class="n">s1_hi_low</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-10-264"><a id="__codelineno-10-264" name="__codelineno-10-264" href="#__codelineno-10-264"></a>
</span><span id="__span-10-265"><a id="__codelineno-10-265" name="__codelineno-10-265" href="#__codelineno-10-265"></a><span class="w">    </span><span class="n">__m256i</span><span class="w"> </span><span class="n">s1_lo_high</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-266"><a id="__codelineno-10-266" name="__codelineno-10-266" href="#__codelineno-10-266"></a><span class="w">        </span><span class="n">_mm512_cvtepi64_epi32</span><span class="p">(</span><span class="n">_mm512_srli_epi64</span><span class="p">(</span><span class="n">generator</span><span class="p">.</span><span class="n">vec_s1_lo</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">));</span>
</span><span id="__span-10-267"><a id="__codelineno-10-267" name="__codelineno-10-267" href="#__codelineno-10-267"></a><span class="w">    </span><span class="n">__m256i</span><span class="w"> </span><span class="n">s1_hi_high</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-268"><a id="__codelineno-10-268" name="__codelineno-10-268" href="#__codelineno-10-268"></a><span class="w">        </span><span class="n">_mm512_cvtepi64_epi32</span><span class="p">(</span><span class="n">_mm512_srli_epi64</span><span class="p">(</span><span class="n">generator</span><span class="p">.</span><span class="n">vec_s1_hi</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">));</span>
</span><span id="__span-10-269"><a id="__codelineno-10-269" name="__codelineno-10-269" href="#__codelineno-10-269"></a><span class="w">    </span><span class="n">__reg</span><span class="w"> </span><span class="n">x5</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-270"><a id="__codelineno-10-270" name="__codelineno-10-270" href="#__codelineno-10-270"></a><span class="w">        </span><span class="n">_mm512_inserti32x8</span><span class="p">(</span><span class="n">_mm512_castsi256_si512</span><span class="p">(</span><span class="n">s1_lo_high</span><span class="p">),</span><span class="w"> </span><span class="n">s1_hi_high</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-10-271"><a id="__codelineno-10-271" name="__codelineno-10-271" href="#__codelineno-10-271"></a>
</span><span id="__span-10-272"><a id="__codelineno-10-272" name="__codelineno-10-272" href="#__codelineno-10-272"></a><span class="w">    </span><span class="n">__m256i</span><span class="w"> </span><span class="n">s2_lo_low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_cvtepi64_epi32</span><span class="p">(</span><span class="n">generator</span><span class="p">.</span><span class="n">vec_s2_lo</span><span class="p">);</span>
</span><span id="__span-10-273"><a id="__codelineno-10-273" name="__codelineno-10-273" href="#__codelineno-10-273"></a><span class="w">    </span><span class="n">__m256i</span><span class="w"> </span><span class="n">s2_hi_low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_cvtepi64_epi32</span><span class="p">(</span><span class="n">generator</span><span class="p">.</span><span class="n">vec_s2_hi</span><span class="p">);</span>
</span><span id="__span-10-274"><a id="__codelineno-10-274" name="__codelineno-10-274" href="#__codelineno-10-274"></a><span class="w">    </span><span class="n">__reg</span><span class="w"> </span><span class="n">x8</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-275"><a id="__codelineno-10-275" name="__codelineno-10-275" href="#__codelineno-10-275"></a><span class="w">        </span><span class="n">_mm512_inserti32x8</span><span class="p">(</span><span class="n">_mm512_castsi256_si512</span><span class="p">(</span><span class="n">s2_lo_low</span><span class="p">),</span><span class="w"> </span><span class="n">s2_hi_low</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-10-276"><a id="__codelineno-10-276" name="__codelineno-10-276" href="#__codelineno-10-276"></a>
</span><span id="__span-10-277"><a id="__codelineno-10-277" name="__codelineno-10-277" href="#__codelineno-10-277"></a><span class="w">    </span><span class="n">__m256i</span><span class="w"> </span><span class="n">s2_lo_high</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-278"><a id="__codelineno-10-278" name="__codelineno-10-278" href="#__codelineno-10-278"></a><span class="w">        </span><span class="n">_mm512_cvtepi64_epi32</span><span class="p">(</span><span class="n">_mm512_srli_epi64</span><span class="p">(</span><span class="n">generator</span><span class="p">.</span><span class="n">vec_s2_lo</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">));</span>
</span><span id="__span-10-279"><a id="__codelineno-10-279" name="__codelineno-10-279" href="#__codelineno-10-279"></a><span class="w">    </span><span class="n">__m256i</span><span class="w"> </span><span class="n">s2_hi_high</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-280"><a id="__codelineno-10-280" name="__codelineno-10-280" href="#__codelineno-10-280"></a><span class="w">        </span><span class="n">_mm512_cvtepi64_epi32</span><span class="p">(</span><span class="n">_mm512_srli_epi64</span><span class="p">(</span><span class="n">generator</span><span class="p">.</span><span class="n">vec_s2_hi</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">));</span>
</span><span id="__span-10-281"><a id="__codelineno-10-281" name="__codelineno-10-281" href="#__codelineno-10-281"></a><span class="w">    </span><span class="n">__reg</span><span class="w"> </span><span class="n">x9</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-282"><a id="__codelineno-10-282" name="__codelineno-10-282" href="#__codelineno-10-282"></a><span class="w">        </span><span class="n">_mm512_inserti32x8</span><span class="p">(</span><span class="n">_mm512_castsi256_si512</span><span class="p">(</span><span class="n">s2_lo_high</span><span class="p">),</span><span class="w"> </span><span class="n">s2_hi_high</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-10-283"><a id="__codelineno-10-283" name="__codelineno-10-283" href="#__codelineno-10-283"></a>
</span><span id="__span-10-284"><a id="__codelineno-10-284" name="__codelineno-10-284" href="#__codelineno-10-284"></a><span class="w">    </span><span class="c1">// 预先计算常量，避免重复设置</span>
</span><span id="__span-10-285"><a id="__codelineno-10-285" name="__codelineno-10-285" href="#__codelineno-10-285"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_setzero_si512</span><span class="p">();</span>
</span><span id="__span-10-286"><a id="__codelineno-10-286" name="__codelineno-10-286" href="#__codelineno-10-286"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">x3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_setzero_si512</span><span class="p">();</span>
</span><span id="__span-10-287"><a id="__codelineno-10-287" name="__codelineno-10-287" href="#__codelineno-10-287"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">x6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_setzero_si512</span><span class="p">();</span>
</span><span id="__span-10-288"><a id="__codelineno-10-288" name="__codelineno-10-288" href="#__codelineno-10-288"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">x7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_setzero_si512</span><span class="p">();</span>
</span><span id="__span-10-289"><a id="__codelineno-10-289" name="__codelineno-10-289" href="#__codelineno-10-289"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">x10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_setzero_si512</span><span class="p">();</span>
</span><span id="__span-10-290"><a id="__codelineno-10-290" name="__codelineno-10-290" href="#__codelineno-10-290"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">x11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_setzero_si512</span><span class="p">();</span>
</span><span id="__span-10-291"><a id="__codelineno-10-291" name="__codelineno-10-291" href="#__codelineno-10-291"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">x12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_set1_epi32</span><span class="p">(</span><span class="mh">0x80u</span><span class="p">);</span>
</span><span id="__span-10-292"><a id="__codelineno-10-292" name="__codelineno-10-292" href="#__codelineno-10-292"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">x13</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_setzero_si512</span><span class="p">();</span>
</span><span id="__span-10-293"><a id="__codelineno-10-293" name="__codelineno-10-293" href="#__codelineno-10-293"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">x14</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_set1_epi32</span><span class="p">(</span><span class="mi">384u</span><span class="p">);</span>
</span><span id="__span-10-294"><a id="__codelineno-10-294" name="__codelineno-10-294" href="#__codelineno-10-294"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">x15</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_setzero_si512</span><span class="p">();</span>
</span><span id="__span-10-295"><a id="__codelineno-10-295" name="__codelineno-10-295" href="#__codelineno-10-295"></a>
</span><span id="__span-10-296"><a id="__codelineno-10-296" name="__codelineno-10-296" href="#__codelineno-10-296"></a><span class="w">    </span><span class="n">__reg</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span><span id="__span-10-297"><a id="__codelineno-10-297" name="__codelineno-10-297" href="#__codelineno-10-297"></a>
</span><span id="__span-10-298"><a id="__codelineno-10-298" name="__codelineno-10-298" href="#__codelineno-10-298"></a><span class="w">    </span><span class="cm">/* Round 1 - 保持原有逻辑 */</span>
</span><span id="__span-10-299"><a id="__codelineno-10-299" name="__codelineno-10-299" href="#__codelineno-10-299"></a><span class="w">    </span><span class="n">FF</span><span class="o">&lt;</span><span class="mi">7</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">x0</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span id="__span-10-300"><a id="__codelineno-10-300" name="__codelineno-10-300" href="#__codelineno-10-300"></a><span class="w">    </span><span class="n">FF</span><span class="o">&lt;</span><span class="mi">12</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span id="__span-10-301"><a id="__codelineno-10-301" name="__codelineno-10-301" href="#__codelineno-10-301"></a><span class="w">    </span><span class="n">FF</span><span class="o">&lt;</span><span class="mi">17</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span><span id="__span-10-302"><a id="__codelineno-10-302" name="__codelineno-10-302" href="#__codelineno-10-302"></a><span class="w">    </span><span class="n">FF</span><span class="o">&lt;</span><span class="mi">22</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x3</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
</span><span id="__span-10-303"><a id="__codelineno-10-303" name="__codelineno-10-303" href="#__codelineno-10-303"></a><span class="w">    </span><span class="n">FF</span><span class="o">&lt;</span><span class="mi">7</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">x4</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
</span><span id="__span-10-304"><a id="__codelineno-10-304" name="__codelineno-10-304" href="#__codelineno-10-304"></a><span class="w">    </span><span class="n">FF</span><span class="o">&lt;</span><span class="mi">12</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x5</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span>
</span><span id="__span-10-305"><a id="__codelineno-10-305" name="__codelineno-10-305" href="#__codelineno-10-305"></a><span class="w">    </span><span class="n">FF</span><span class="o">&lt;</span><span class="mi">17</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x6</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">6</span><span class="p">]);</span>
</span><span id="__span-10-306"><a id="__codelineno-10-306" name="__codelineno-10-306" href="#__codelineno-10-306"></a><span class="w">    </span><span class="n">FF</span><span class="o">&lt;</span><span class="mi">22</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x7</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
</span><span id="__span-10-307"><a id="__codelineno-10-307" name="__codelineno-10-307" href="#__codelineno-10-307"></a><span class="w">    </span><span class="n">FF</span><span class="o">&lt;</span><span class="mi">7</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">x8</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">8</span><span class="p">]);</span>
</span><span id="__span-10-308"><a id="__codelineno-10-308" name="__codelineno-10-308" href="#__codelineno-10-308"></a><span class="w">    </span><span class="n">FF</span><span class="o">&lt;</span><span class="mi">12</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x9</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">9</span><span class="p">]);</span>
</span><span id="__span-10-309"><a id="__codelineno-10-309" name="__codelineno-10-309" href="#__codelineno-10-309"></a><span class="w">    </span><span class="n">FF</span><span class="o">&lt;</span><span class="mi">17</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x10</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">10</span><span class="p">]);</span>
</span><span id="__span-10-310"><a id="__codelineno-10-310" name="__codelineno-10-310" href="#__codelineno-10-310"></a><span class="w">    </span><span class="n">FF</span><span class="o">&lt;</span><span class="mi">22</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x11</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">11</span><span class="p">]);</span>
</span><span id="__span-10-311"><a id="__codelineno-10-311" name="__codelineno-10-311" href="#__codelineno-10-311"></a><span class="w">    </span><span class="n">FF</span><span class="o">&lt;</span><span class="mi">7</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">x12</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">12</span><span class="p">]);</span>
</span><span id="__span-10-312"><a id="__codelineno-10-312" name="__codelineno-10-312" href="#__codelineno-10-312"></a><span class="w">    </span><span class="n">FF</span><span class="o">&lt;</span><span class="mi">12</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x13</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">13</span><span class="p">]);</span>
</span><span id="__span-10-313"><a id="__codelineno-10-313" name="__codelineno-10-313" href="#__codelineno-10-313"></a><span class="w">    </span><span class="n">FF</span><span class="o">&lt;</span><span class="mi">17</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x14</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">14</span><span class="p">]);</span>
</span><span id="__span-10-314"><a id="__codelineno-10-314" name="__codelineno-10-314" href="#__codelineno-10-314"></a><span class="w">    </span><span class="n">FF</span><span class="o">&lt;</span><span class="mi">22</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x15</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">15</span><span class="p">]);</span>
</span><span id="__span-10-315"><a id="__codelineno-10-315" name="__codelineno-10-315" href="#__codelineno-10-315"></a>
</span><span id="__span-10-316"><a id="__codelineno-10-316" name="__codelineno-10-316" href="#__codelineno-10-316"></a><span class="w">    </span><span class="cm">/* Round 2 */</span>
</span><span id="__span-10-317"><a id="__codelineno-10-317" name="__codelineno-10-317" href="#__codelineno-10-317"></a><span class="w">    </span><span class="n">GG</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">16</span><span class="p">]);</span>
</span><span id="__span-10-318"><a id="__codelineno-10-318" name="__codelineno-10-318" href="#__codelineno-10-318"></a><span class="w">    </span><span class="n">GG</span><span class="o">&lt;</span><span class="mi">9</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x6</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">17</span><span class="p">]);</span>
</span><span id="__span-10-319"><a id="__codelineno-10-319" name="__codelineno-10-319" href="#__codelineno-10-319"></a><span class="w">    </span><span class="n">GG</span><span class="o">&lt;</span><span class="mi">14</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x11</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">18</span><span class="p">]);</span>
</span><span id="__span-10-320"><a id="__codelineno-10-320" name="__codelineno-10-320" href="#__codelineno-10-320"></a><span class="w">    </span><span class="n">GG</span><span class="o">&lt;</span><span class="mi">20</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x0</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">19</span><span class="p">]);</span>
</span><span id="__span-10-321"><a id="__codelineno-10-321" name="__codelineno-10-321" href="#__codelineno-10-321"></a><span class="w">    </span><span class="n">GG</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">x5</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">20</span><span class="p">]);</span>
</span><span id="__span-10-322"><a id="__codelineno-10-322" name="__codelineno-10-322" href="#__codelineno-10-322"></a><span class="w">    </span><span class="n">GG</span><span class="o">&lt;</span><span class="mi">9</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x10</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">21</span><span class="p">]);</span>
</span><span id="__span-10-323"><a id="__codelineno-10-323" name="__codelineno-10-323" href="#__codelineno-10-323"></a><span class="w">    </span><span class="n">GG</span><span class="o">&lt;</span><span class="mi">14</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x15</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">22</span><span class="p">]);</span>
</span><span id="__span-10-324"><a id="__codelineno-10-324" name="__codelineno-10-324" href="#__codelineno-10-324"></a><span class="w">    </span><span class="n">GG</span><span class="o">&lt;</span><span class="mi">20</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x4</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">23</span><span class="p">]);</span>
</span><span id="__span-10-325"><a id="__codelineno-10-325" name="__codelineno-10-325" href="#__codelineno-10-325"></a><span class="w">    </span><span class="n">GG</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">x9</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">24</span><span class="p">]);</span>
</span><span id="__span-10-326"><a id="__codelineno-10-326" name="__codelineno-10-326" href="#__codelineno-10-326"></a><span class="w">    </span><span class="n">GG</span><span class="o">&lt;</span><span class="mi">9</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x14</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">25</span><span class="p">]);</span>
</span><span id="__span-10-327"><a id="__codelineno-10-327" name="__codelineno-10-327" href="#__codelineno-10-327"></a><span class="w">    </span><span class="n">GG</span><span class="o">&lt;</span><span class="mi">14</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x3</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">26</span><span class="p">]);</span>
</span><span id="__span-10-328"><a id="__codelineno-10-328" name="__codelineno-10-328" href="#__codelineno-10-328"></a><span class="w">    </span><span class="n">GG</span><span class="o">&lt;</span><span class="mi">20</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x8</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">27</span><span class="p">]);</span>
</span><span id="__span-10-329"><a id="__codelineno-10-329" name="__codelineno-10-329" href="#__codelineno-10-329"></a><span class="w">    </span><span class="n">GG</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">x13</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">28</span><span class="p">]);</span>
</span><span id="__span-10-330"><a id="__codelineno-10-330" name="__codelineno-10-330" href="#__codelineno-10-330"></a><span class="w">    </span><span class="n">GG</span><span class="o">&lt;</span><span class="mi">9</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">29</span><span class="p">]);</span>
</span><span id="__span-10-331"><a id="__codelineno-10-331" name="__codelineno-10-331" href="#__codelineno-10-331"></a><span class="w">    </span><span class="n">GG</span><span class="o">&lt;</span><span class="mi">14</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x7</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">30</span><span class="p">]);</span>
</span><span id="__span-10-332"><a id="__codelineno-10-332" name="__codelineno-10-332" href="#__codelineno-10-332"></a><span class="w">    </span><span class="n">GG</span><span class="o">&lt;</span><span class="mi">20</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x12</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">31</span><span class="p">]);</span>
</span><span id="__span-10-333"><a id="__codelineno-10-333" name="__codelineno-10-333" href="#__codelineno-10-333"></a>
</span><span id="__span-10-334"><a id="__codelineno-10-334" name="__codelineno-10-334" href="#__codelineno-10-334"></a><span class="w">    </span><span class="cm">/* Round 3 */</span>
</span><span id="__span-10-335"><a id="__codelineno-10-335" name="__codelineno-10-335" href="#__codelineno-10-335"></a><span class="w">    </span><span class="n">HH</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">x5</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">32</span><span class="p">]);</span>
</span><span id="__span-10-336"><a id="__codelineno-10-336" name="__codelineno-10-336" href="#__codelineno-10-336"></a><span class="w">    </span><span class="n">HH</span><span class="o">&lt;</span><span class="mi">11</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x8</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">33</span><span class="p">]);</span>
</span><span id="__span-10-337"><a id="__codelineno-10-337" name="__codelineno-10-337" href="#__codelineno-10-337"></a><span class="w">    </span><span class="n">HH</span><span class="o">&lt;</span><span class="mi">16</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x11</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">34</span><span class="p">]);</span>
</span><span id="__span-10-338"><a id="__codelineno-10-338" name="__codelineno-10-338" href="#__codelineno-10-338"></a><span class="w">    </span><span class="n">HH</span><span class="o">&lt;</span><span class="mi">23</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x14</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">35</span><span class="p">]);</span>
</span><span id="__span-10-339"><a id="__codelineno-10-339" name="__codelineno-10-339" href="#__codelineno-10-339"></a><span class="w">    </span><span class="n">HH</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">36</span><span class="p">]);</span>
</span><span id="__span-10-340"><a id="__codelineno-10-340" name="__codelineno-10-340" href="#__codelineno-10-340"></a><span class="w">    </span><span class="n">HH</span><span class="o">&lt;</span><span class="mi">11</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x4</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">37</span><span class="p">]);</span>
</span><span id="__span-10-341"><a id="__codelineno-10-341" name="__codelineno-10-341" href="#__codelineno-10-341"></a><span class="w">    </span><span class="n">HH</span><span class="o">&lt;</span><span class="mi">16</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x7</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">38</span><span class="p">]);</span>
</span><span id="__span-10-342"><a id="__codelineno-10-342" name="__codelineno-10-342" href="#__codelineno-10-342"></a><span class="w">    </span><span class="n">HH</span><span class="o">&lt;</span><span class="mi">23</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x10</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">39</span><span class="p">]);</span>
</span><span id="__span-10-343"><a id="__codelineno-10-343" name="__codelineno-10-343" href="#__codelineno-10-343"></a><span class="w">    </span><span class="n">HH</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">x13</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">40</span><span class="p">]);</span>
</span><span id="__span-10-344"><a id="__codelineno-10-344" name="__codelineno-10-344" href="#__codelineno-10-344"></a><span class="w">    </span><span class="n">HH</span><span class="o">&lt;</span><span class="mi">11</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x0</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">41</span><span class="p">]);</span>
</span><span id="__span-10-345"><a id="__codelineno-10-345" name="__codelineno-10-345" href="#__codelineno-10-345"></a><span class="w">    </span><span class="n">HH</span><span class="o">&lt;</span><span class="mi">16</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x3</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">42</span><span class="p">]);</span>
</span><span id="__span-10-346"><a id="__codelineno-10-346" name="__codelineno-10-346" href="#__codelineno-10-346"></a><span class="w">    </span><span class="n">HH</span><span class="o">&lt;</span><span class="mi">23</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x6</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">43</span><span class="p">]);</span>
</span><span id="__span-10-347"><a id="__codelineno-10-347" name="__codelineno-10-347" href="#__codelineno-10-347"></a><span class="w">    </span><span class="n">HH</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">x9</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">44</span><span class="p">]);</span>
</span><span id="__span-10-348"><a id="__codelineno-10-348" name="__codelineno-10-348" href="#__codelineno-10-348"></a><span class="w">    </span><span class="n">HH</span><span class="o">&lt;</span><span class="mi">11</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x12</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">45</span><span class="p">]);</span>
</span><span id="__span-10-349"><a id="__codelineno-10-349" name="__codelineno-10-349" href="#__codelineno-10-349"></a><span class="w">    </span><span class="n">HH</span><span class="o">&lt;</span><span class="mi">16</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x15</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">46</span><span class="p">]);</span>
</span><span id="__span-10-350"><a id="__codelineno-10-350" name="__codelineno-10-350" href="#__codelineno-10-350"></a><span class="w">    </span><span class="n">HH</span><span class="o">&lt;</span><span class="mi">23</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">47</span><span class="p">]);</span>
</span><span id="__span-10-351"><a id="__codelineno-10-351" name="__codelineno-10-351" href="#__codelineno-10-351"></a>
</span><span id="__span-10-352"><a id="__codelineno-10-352" name="__codelineno-10-352" href="#__codelineno-10-352"></a><span class="w">    </span><span class="cm">/* Round 4 */</span>
</span><span id="__span-10-353"><a id="__codelineno-10-353" name="__codelineno-10-353" href="#__codelineno-10-353"></a><span class="w">    </span><span class="n">II</span><span class="o">&lt;</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">x0</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">48</span><span class="p">]);</span>
</span><span id="__span-10-354"><a id="__codelineno-10-354" name="__codelineno-10-354" href="#__codelineno-10-354"></a><span class="w">    </span><span class="n">II</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x7</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">49</span><span class="p">]);</span>
</span><span id="__span-10-355"><a id="__codelineno-10-355" name="__codelineno-10-355" href="#__codelineno-10-355"></a><span class="w">    </span><span class="n">II</span><span class="o">&lt;</span><span class="mi">15</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x14</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">50</span><span class="p">]);</span>
</span><span id="__span-10-356"><a id="__codelineno-10-356" name="__codelineno-10-356" href="#__codelineno-10-356"></a><span class="w">    </span><span class="n">II</span><span class="o">&lt;</span><span class="mi">21</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x5</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">51</span><span class="p">]);</span>
</span><span id="__span-10-357"><a id="__codelineno-10-357" name="__codelineno-10-357" href="#__codelineno-10-357"></a><span class="w">    </span><span class="n">II</span><span class="o">&lt;</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">x12</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">52</span><span class="p">]);</span>
</span><span id="__span-10-358"><a id="__codelineno-10-358" name="__codelineno-10-358" href="#__codelineno-10-358"></a><span class="w">    </span><span class="n">II</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x3</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">53</span><span class="p">]);</span>
</span><span id="__span-10-359"><a id="__codelineno-10-359" name="__codelineno-10-359" href="#__codelineno-10-359"></a><span class="w">    </span><span class="n">II</span><span class="o">&lt;</span><span class="mi">15</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x10</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">54</span><span class="p">]);</span>
</span><span id="__span-10-360"><a id="__codelineno-10-360" name="__codelineno-10-360" href="#__codelineno-10-360"></a><span class="w">    </span><span class="n">II</span><span class="o">&lt;</span><span class="mi">21</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">55</span><span class="p">]);</span>
</span><span id="__span-10-361"><a id="__codelineno-10-361" name="__codelineno-10-361" href="#__codelineno-10-361"></a><span class="w">    </span><span class="n">II</span><span class="o">&lt;</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">x8</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">56</span><span class="p">]);</span>
</span><span id="__span-10-362"><a id="__codelineno-10-362" name="__codelineno-10-362" href="#__codelineno-10-362"></a><span class="w">    </span><span class="n">II</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x15</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">57</span><span class="p">]);</span>
</span><span id="__span-10-363"><a id="__codelineno-10-363" name="__codelineno-10-363" href="#__codelineno-10-363"></a><span class="w">    </span><span class="n">II</span><span class="o">&lt;</span><span class="mi">15</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x6</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">58</span><span class="p">]);</span>
</span><span id="__span-10-364"><a id="__codelineno-10-364" name="__codelineno-10-364" href="#__codelineno-10-364"></a><span class="w">    </span><span class="n">II</span><span class="o">&lt;</span><span class="mi">21</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x13</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">59</span><span class="p">]);</span>
</span><span id="__span-10-365"><a id="__codelineno-10-365" name="__codelineno-10-365" href="#__codelineno-10-365"></a><span class="w">    </span><span class="n">II</span><span class="o">&lt;</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">x4</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">60</span><span class="p">]);</span>
</span><span id="__span-10-366"><a id="__codelineno-10-366" name="__codelineno-10-366" href="#__codelineno-10-366"></a><span class="w">    </span><span class="n">II</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">x11</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">61</span><span class="p">]);</span>
</span><span id="__span-10-367"><a id="__codelineno-10-367" name="__codelineno-10-367" href="#__codelineno-10-367"></a><span class="w">    </span><span class="n">II</span><span class="o">&lt;</span><span class="mi">15</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">62</span><span class="p">]);</span>
</span><span id="__span-10-368"><a id="__codelineno-10-368" name="__codelineno-10-368" href="#__codelineno-10-368"></a><span class="w">    </span><span class="n">II</span><span class="o">&lt;</span><span class="mi">21</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x9</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="mi">63</span><span class="p">]);</span>
</span><span id="__span-10-369"><a id="__codelineno-10-369" name="__codelineno-10-369" href="#__codelineno-10-369"></a>
</span><span id="__span-10-370"><a id="__codelineno-10-370" name="__codelineno-10-370" href="#__codelineno-10-370"></a><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">);</span>
</span><span id="__span-10-371"><a id="__codelineno-10-371" name="__codelineno-10-371" href="#__codelineno-10-371"></a><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
</span><span id="__span-10-372"><a id="__codelineno-10-372" name="__codelineno-10-372" href="#__codelineno-10-372"></a><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">c</span><span class="p">);</span>
</span><span id="__span-10-373"><a id="__codelineno-10-373" name="__codelineno-10-373" href="#__codelineno-10-373"></a><span class="w">    </span><span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">d</span><span class="p">);</span>
</span><span id="__span-10-374"><a id="__codelineno-10-374" name="__codelineno-10-374" href="#__codelineno-10-374"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-375"><a id="__codelineno-10-375" name="__codelineno-10-375" href="#__codelineno-10-375"></a>
</span><span id="__span-10-376"><a id="__codelineno-10-376" name="__codelineno-10-376" href="#__codelineno-10-376"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">finalize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-377"><a id="__codelineno-10-377" name="__codelineno-10-377" href="#__codelineno-10-377"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">finalized</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-378"><a id="__codelineno-10-378" name="__codelineno-10-378" href="#__codelineno-10-378"></a><span class="w">      </span><span class="n">digest_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span id="__span-10-379"><a id="__codelineno-10-379" name="__codelineno-10-379" href="#__codelineno-10-379"></a><span class="w">      </span><span class="n">digest_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span id="__span-10-380"><a id="__codelineno-10-380" name="__codelineno-10-380" href="#__codelineno-10-380"></a><span class="w">      </span><span class="n">digest_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span><span id="__span-10-381"><a id="__codelineno-10-381" name="__codelineno-10-381" href="#__codelineno-10-381"></a><span class="w">      </span><span class="n">digest_d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span><span id="__span-10-382"><a id="__codelineno-10-382" name="__codelineno-10-382" href="#__codelineno-10-382"></a><span class="w">      </span><span class="n">finalized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-10-383"><a id="__codelineno-10-383" name="__codelineno-10-383" href="#__codelineno-10-383"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-384"><a id="__codelineno-10-384" name="__codelineno-10-384" href="#__codelineno-10-384"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-385"><a id="__codelineno-10-385" name="__codelineno-10-385" href="#__codelineno-10-385"></a>
</span><span id="__span-10-386"><a id="__codelineno-10-386" name="__codelineno-10-386" href="#__codelineno-10-386"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">__reg</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-387"><a id="__codelineno-10-387" name="__codelineno-10-387" href="#__codelineno-10-387"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_and_si512</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">)));</span>
</span><span id="__span-10-388"><a id="__codelineno-10-388" name="__codelineno-10-388" href="#__codelineno-10-388"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-389"><a id="__codelineno-10-389" name="__codelineno-10-389" href="#__codelineno-10-389"></a>
</span><span id="__span-10-390"><a id="__codelineno-10-390" name="__codelineno-10-390" href="#__codelineno-10-390"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">G</span><span class="p">(</span><span class="n">__reg</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-391"><a id="__codelineno-10-391" name="__codelineno-10-391" href="#__codelineno-10-391"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_and_si512</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)));</span>
</span><span id="__span-10-392"><a id="__codelineno-10-392" name="__codelineno-10-392" href="#__codelineno-10-392"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-393"><a id="__codelineno-10-393" name="__codelineno-10-393" href="#__codelineno-10-393"></a>
</span><span id="__span-10-394"><a id="__codelineno-10-394" name="__codelineno-10-394" href="#__codelineno-10-394"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">__reg</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-395"><a id="__codelineno-10-395" name="__codelineno-10-395" href="#__codelineno-10-395"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">),</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>
</span><span id="__span-10-396"><a id="__codelineno-10-396" name="__codelineno-10-396" href="#__codelineno-10-396"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-397"><a id="__codelineno-10-397" name="__codelineno-10-397" href="#__codelineno-10-397"></a>
</span><span id="__span-10-398"><a id="__codelineno-10-398" name="__codelineno-10-398" href="#__codelineno-10-398"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">I</span><span class="p">(</span><span class="n">__reg</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-399"><a id="__codelineno-10-399" name="__codelineno-10-399" href="#__codelineno-10-399"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">_mm512_xor_si512</span><span class="p">(</span>
</span><span id="__span-10-400"><a id="__codelineno-10-400" name="__codelineno-10-400" href="#__codelineno-10-400"></a><span class="w">        </span><span class="n">y</span><span class="p">,</span>
</span><span id="__span-10-401"><a id="__codelineno-10-401" name="__codelineno-10-401" href="#__codelineno-10-401"></a><span class="w">        </span><span class="n">_mm512_or_si512</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">_mm512_set1_epi32</span><span class="p">(</span><span class="mh">0xFFFFFFFF</span><span class="p">))));</span>
</span><span id="__span-10-402"><a id="__codelineno-10-402" name="__codelineno-10-402" href="#__codelineno-10-402"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-403"><a id="__codelineno-10-403" name="__codelineno-10-403" href="#__codelineno-10-403"></a>
</span><span id="__span-10-404"><a id="__codelineno-10-404" name="__codelineno-10-404" href="#__codelineno-10-404"></a><span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="o">&gt;</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">rotate_left</span><span class="p">(</span><span class="n">__reg</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-405"><a id="__codelineno-10-405" name="__codelineno-10-405" href="#__codelineno-10-405"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">_mm512_or_si512</span><span class="p">(</span><span class="n">_mm512_slli_epi32</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span>
</span><span id="__span-10-406"><a id="__codelineno-10-406" name="__codelineno-10-406" href="#__codelineno-10-406"></a><span class="w">                           </span><span class="n">_mm512_srli_epi32</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">N</span><span class="p">));</span>
</span><span id="__span-10-407"><a id="__codelineno-10-407" name="__codelineno-10-407" href="#__codelineno-10-407"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-408"><a id="__codelineno-10-408" name="__codelineno-10-408" href="#__codelineno-10-408"></a>
</span><span id="__span-10-409"><a id="__codelineno-10-409" name="__codelineno-10-409" href="#__codelineno-10-409"></a><span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">int</span><span class="w"> </span><span class="n">S</span><span class="o">&gt;</span>
</span><span id="__span-10-410"><a id="__codelineno-10-410" name="__codelineno-10-410" href="#__codelineno-10-410"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">FF</span><span class="p">(</span><span class="n">__reg</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">x</span><span class="p">,</span>
</span><span id="__span-10-411"><a id="__codelineno-10-411" name="__codelineno-10-411" href="#__codelineno-10-411"></a><span class="w">                        </span><span class="n">__reg</span><span class="w"> </span><span class="n">ac</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-412"><a id="__codelineno-10-412" name="__codelineno-10-412" href="#__codelineno-10-412"></a><span class="w">    </span><span class="n">__reg</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">);</span>
</span><span id="__span-10-413"><a id="__codelineno-10-413" name="__codelineno-10-413" href="#__codelineno-10-413"></a><span class="w">    </span><span class="n">__reg</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-414"><a id="__codelineno-10-414" name="__codelineno-10-414" href="#__codelineno-10-414"></a><span class="w">        </span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">),</span><span class="w"> </span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">ac</span><span class="p">));</span>
</span><span id="__span-10-415"><a id="__codelineno-10-415" name="__codelineno-10-415" href="#__codelineno-10-415"></a><span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">rotate_left</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="p">(</span><span class="n">sum</span><span class="p">));</span>
</span><span id="__span-10-416"><a id="__codelineno-10-416" name="__codelineno-10-416" href="#__codelineno-10-416"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-417"><a id="__codelineno-10-417" name="__codelineno-10-417" href="#__codelineno-10-417"></a>
</span><span id="__span-10-418"><a id="__codelineno-10-418" name="__codelineno-10-418" href="#__codelineno-10-418"></a><span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">int</span><span class="w"> </span><span class="n">S</span><span class="o">&gt;</span>
</span><span id="__span-10-419"><a id="__codelineno-10-419" name="__codelineno-10-419" href="#__codelineno-10-419"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">GG</span><span class="p">(</span><span class="n">__reg</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">x</span><span class="p">,</span>
</span><span id="__span-10-420"><a id="__codelineno-10-420" name="__codelineno-10-420" href="#__codelineno-10-420"></a><span class="w">                        </span><span class="n">__reg</span><span class="w"> </span><span class="n">ac</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-421"><a id="__codelineno-10-421" name="__codelineno-10-421" href="#__codelineno-10-421"></a><span class="w">    </span><span class="n">__reg</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">G</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">);</span>
</span><span id="__span-10-422"><a id="__codelineno-10-422" name="__codelineno-10-422" href="#__codelineno-10-422"></a><span class="w">    </span><span class="n">__reg</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-423"><a id="__codelineno-10-423" name="__codelineno-10-423" href="#__codelineno-10-423"></a><span class="w">        </span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">),</span><span class="w"> </span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">ac</span><span class="p">));</span>
</span><span id="__span-10-424"><a id="__codelineno-10-424" name="__codelineno-10-424" href="#__codelineno-10-424"></a><span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">rotate_left</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="p">(</span><span class="n">sum</span><span class="p">));</span>
</span><span id="__span-10-425"><a id="__codelineno-10-425" name="__codelineno-10-425" href="#__codelineno-10-425"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-426"><a id="__codelineno-10-426" name="__codelineno-10-426" href="#__codelineno-10-426"></a>
</span><span id="__span-10-427"><a id="__codelineno-10-427" name="__codelineno-10-427" href="#__codelineno-10-427"></a><span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">int</span><span class="w"> </span><span class="n">S</span><span class="o">&gt;</span>
</span><span id="__span-10-428"><a id="__codelineno-10-428" name="__codelineno-10-428" href="#__codelineno-10-428"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">HH</span><span class="p">(</span><span class="n">__reg</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">x</span><span class="p">,</span>
</span><span id="__span-10-429"><a id="__codelineno-10-429" name="__codelineno-10-429" href="#__codelineno-10-429"></a><span class="w">                        </span><span class="n">__reg</span><span class="w"> </span><span class="n">ac</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-430"><a id="__codelineno-10-430" name="__codelineno-10-430" href="#__codelineno-10-430"></a><span class="w">    </span><span class="n">__reg</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">);</span>
</span><span id="__span-10-431"><a id="__codelineno-10-431" name="__codelineno-10-431" href="#__codelineno-10-431"></a><span class="w">    </span><span class="n">__reg</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-432"><a id="__codelineno-10-432" name="__codelineno-10-432" href="#__codelineno-10-432"></a><span class="w">        </span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">),</span><span class="w"> </span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">ac</span><span class="p">));</span>
</span><span id="__span-10-433"><a id="__codelineno-10-433" name="__codelineno-10-433" href="#__codelineno-10-433"></a><span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">rotate_left</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="p">(</span><span class="n">sum</span><span class="p">));</span>
</span><span id="__span-10-434"><a id="__codelineno-10-434" name="__codelineno-10-434" href="#__codelineno-10-434"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-435"><a id="__codelineno-10-435" name="__codelineno-10-435" href="#__codelineno-10-435"></a>
</span><span id="__span-10-436"><a id="__codelineno-10-436" name="__codelineno-10-436" href="#__codelineno-10-436"></a><span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">int</span><span class="w"> </span><span class="n">S</span><span class="o">&gt;</span>
</span><span id="__span-10-437"><a id="__codelineno-10-437" name="__codelineno-10-437" href="#__codelineno-10-437"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">II</span><span class="p">(</span><span class="n">__reg</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">__reg</span><span class="w"> </span><span class="n">x</span><span class="p">,</span>
</span><span id="__span-10-438"><a id="__codelineno-10-438" name="__codelineno-10-438" href="#__codelineno-10-438"></a><span class="w">                        </span><span class="n">__reg</span><span class="w"> </span><span class="n">ac</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-439"><a id="__codelineno-10-439" name="__codelineno-10-439" href="#__codelineno-10-439"></a><span class="w">    </span><span class="n">__reg</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">);</span>
</span><span id="__span-10-440"><a id="__codelineno-10-440" name="__codelineno-10-440" href="#__codelineno-10-440"></a><span class="w">    </span><span class="n">__reg</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-441"><a id="__codelineno-10-441" name="__codelineno-10-441" href="#__codelineno-10-441"></a><span class="w">        </span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">ac</span><span class="p">));</span>
</span><span id="__span-10-442"><a id="__codelineno-10-442" name="__codelineno-10-442" href="#__codelineno-10-442"></a><span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">rotate_left</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="p">(</span><span class="n">sum</span><span class="p">));</span>
</span><span id="__span-10-443"><a id="__codelineno-10-443" name="__codelineno-10-443" href="#__codelineno-10-443"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-444"><a id="__codelineno-10-444" name="__codelineno-10-444" href="#__codelineno-10-444"></a>
</span><span id="__span-10-445"><a id="__codelineno-10-445" name="__codelineno-10-445" href="#__codelineno-10-445"></a><span class="w">  </span><span class="n">__reg</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span><span id="__span-10-446"><a id="__codelineno-10-446" name="__codelineno-10-446" href="#__codelineno-10-446"></a><span class="w">  </span><span class="n">__reg</span><span class="w"> </span><span class="n">digest_a</span><span class="p">,</span><span class="w"> </span><span class="n">digest_b</span><span class="p">,</span><span class="w"> </span><span class="n">digest_c</span><span class="p">,</span><span class="w"> </span><span class="n">digest_d</span><span class="p">;</span>
</span><span id="__span-10-447"><a id="__codelineno-10-447" name="__codelineno-10-447" href="#__codelineno-10-447"></a><span class="w">  </span><span class="n">__reg</span><span class="w"> </span><span class="n">target_digest_a</span><span class="p">,</span><span class="w"> </span><span class="n">target_digest_b</span><span class="p">,</span><span class="w"> </span><span class="n">target_digest_c</span><span class="p">,</span><span class="w"> </span><span class="n">target_digest_d</span><span class="p">;</span>
</span><span id="__span-10-448"><a id="__codelineno-10-448" name="__codelineno-10-448" href="#__codelineno-10-448"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">finalized</span><span class="p">;</span>
</span><span id="__span-10-449"><a id="__codelineno-10-449" name="__codelineno-10-449" href="#__codelineno-10-449"></a>
</span><span id="__span-10-450"><a id="__codelineno-10-450" name="__codelineno-10-450" href="#__codelineno-10-450"></a><span class="w">  </span><span class="kr">inline</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">r</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w">  </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
</span><span id="__span-10-451"><a id="__codelineno-10-451" name="__codelineno-10-451" href="#__codelineno-10-451"></a><span class="w">                                          </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">21</span><span class="p">};</span>
</span><span id="__span-10-452"><a id="__codelineno-10-452" name="__codelineno-10-452" href="#__codelineno-10-452"></a>
</span><span id="__span-10-453"><a id="__codelineno-10-453" name="__codelineno-10-453" href="#__codelineno-10-453"></a><span class="w">  </span><span class="kr">inline</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">k</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-454"><a id="__codelineno-10-454" name="__codelineno-10-454" href="#__codelineno-10-454"></a><span class="w">      </span><span class="mh">0xd76aa478</span><span class="p">,</span><span class="w"> </span><span class="mh">0xe8c7b756</span><span class="p">,</span><span class="w"> </span><span class="mh">0x242070db</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc1bdceee</span><span class="p">,</span><span class="w"> </span><span class="mh">0xf57c0faf</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4787c62a</span><span class="p">,</span>
</span><span id="__span-10-455"><a id="__codelineno-10-455" name="__codelineno-10-455" href="#__codelineno-10-455"></a><span class="w">      </span><span class="mh">0xa8304613</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfd469501</span><span class="p">,</span><span class="w"> </span><span class="mh">0x698098d8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8b44f7af</span><span class="p">,</span><span class="w"> </span><span class="mh">0xffff5bb1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x895cd7be</span><span class="p">,</span>
</span><span id="__span-10-456"><a id="__codelineno-10-456" name="__codelineno-10-456" href="#__codelineno-10-456"></a><span class="w">      </span><span class="mh">0x6b901122</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfd987193</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa679438e</span><span class="p">,</span><span class="w"> </span><span class="mh">0x49b40821</span><span class="p">,</span><span class="w"> </span><span class="mh">0xf61e2562</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc040b340</span><span class="p">,</span>
</span><span id="__span-10-457"><a id="__codelineno-10-457" name="__codelineno-10-457" href="#__codelineno-10-457"></a><span class="w">      </span><span class="mh">0x265e5a51</span><span class="p">,</span><span class="w"> </span><span class="mh">0xe9b6c7aa</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd62f105d</span><span class="p">,</span><span class="w"> </span><span class="mh">0x02441453</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd8a1e681</span><span class="p">,</span><span class="w"> </span><span class="mh">0xe7d3fbc8</span><span class="p">,</span>
</span><span id="__span-10-458"><a id="__codelineno-10-458" name="__codelineno-10-458" href="#__codelineno-10-458"></a><span class="w">      </span><span class="mh">0x21e1cde6</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc33707d6</span><span class="p">,</span><span class="w"> </span><span class="mh">0xf4d50d87</span><span class="p">,</span><span class="w"> </span><span class="mh">0x455a14ed</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa9e3e905</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfcefa3f8</span><span class="p">,</span>
</span><span id="__span-10-459"><a id="__codelineno-10-459" name="__codelineno-10-459" href="#__codelineno-10-459"></a><span class="w">      </span><span class="mh">0x676f02d9</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8d2a4c8a</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfffa3942</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8771f681</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6d9d6122</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfde5380c</span><span class="p">,</span>
</span><span id="__span-10-460"><a id="__codelineno-10-460" name="__codelineno-10-460" href="#__codelineno-10-460"></a><span class="w">      </span><span class="mh">0xa4beea44</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4bdecfa9</span><span class="p">,</span><span class="w"> </span><span class="mh">0xf6bb4b60</span><span class="p">,</span><span class="w"> </span><span class="mh">0xbebfbc70</span><span class="p">,</span><span class="w"> </span><span class="mh">0x289b7ec6</span><span class="p">,</span><span class="w"> </span><span class="mh">0xeaa127fa</span><span class="p">,</span>
</span><span id="__span-10-461"><a id="__codelineno-10-461" name="__codelineno-10-461" href="#__codelineno-10-461"></a><span class="w">      </span><span class="mh">0xd4ef3085</span><span class="p">,</span><span class="w"> </span><span class="mh">0x04881d05</span><span class="p">,</span><span class="w"> </span><span class="mh">0xd9d4d039</span><span class="p">,</span><span class="w"> </span><span class="mh">0xe6db99e5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1fa27cf8</span><span class="p">,</span><span class="w"> </span><span class="mh">0xc4ac5665</span><span class="p">,</span>
</span><span id="__span-10-462"><a id="__codelineno-10-462" name="__codelineno-10-462" href="#__codelineno-10-462"></a><span class="w">      </span><span class="mh">0xf4292244</span><span class="p">,</span><span class="w"> </span><span class="mh">0x432aff97</span><span class="p">,</span><span class="w"> </span><span class="mh">0xab9423a7</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfc93a039</span><span class="p">,</span><span class="w"> </span><span class="mh">0x655b59c3</span><span class="p">,</span><span class="w"> </span><span class="mh">0x8f0ccc92</span><span class="p">,</span>
</span><span id="__span-10-463"><a id="__codelineno-10-463" name="__codelineno-10-463" href="#__codelineno-10-463"></a><span class="w">      </span><span class="mh">0xffeff47d</span><span class="p">,</span><span class="w"> </span><span class="mh">0x85845dd1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6fa87e4f</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfe2ce6e0</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa3014314</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4e0811a1</span><span class="p">,</span>
</span><span id="__span-10-464"><a id="__codelineno-10-464" name="__codelineno-10-464" href="#__codelineno-10-464"></a><span class="w">      </span><span class="mh">0xf7537e82</span><span class="p">,</span><span class="w"> </span><span class="mh">0xbd3af235</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2ad7d2bb</span><span class="p">,</span><span class="w"> </span><span class="mh">0xeb86d391</span><span class="p">};</span>
</span><span id="__span-10-465"><a id="__codelineno-10-465" name="__codelineno-10-465" href="#__codelineno-10-465"></a>
</span><span id="__span-10-466"><a id="__codelineno-10-466" name="__codelineno-10-466" href="#__codelineno-10-466"></a><span class="w">  </span><span class="n">__reg</span><span class="w"> </span><span class="n">kv</span><span class="p">[</span><span class="k">sizeof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">k</span><span class="p">)];</span>
</span><span id="__span-10-467"><a id="__codelineno-10-467" name="__codelineno-10-467" href="#__codelineno-10-467"></a><span class="p">};</span>
</span><span id="__span-10-468"><a id="__codelineno-10-468" name="__codelineno-10-468" href="#__codelineno-10-468"></a>
</span><span id="__span-10-469"><a id="__codelineno-10-469" name="__codelineno-10-469" href="#__codelineno-10-469"></a><span class="p">}</span><span class="w"> </span><span class="c1">// namespace md5_avx512_soa</span>
</span><span id="__span-10-470"><a id="__codelineno-10-470" name="__codelineno-10-470" href="#__codelineno-10-470"></a>
</span><span id="__span-10-471"><a id="__codelineno-10-471" name="__codelineno-10-471" href="#__codelineno-10-471"></a><span class="c1">// 解析 hex digest（保持原来字节翻转处理）</span>
</span><span id="__span-10-472"><a id="__codelineno-10-472" name="__codelineno-10-472" href="#__codelineno-10-472"></a><span class="kt">void</span><span class="w"> </span><span class="n">parse_hex_digest</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">hex</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">digest</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-473"><a id="__codelineno-10-473" name="__codelineno-10-473" href="#__codelineno-10-473"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hex</span><span class="p">.</span><span class="n">length</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-474"><a id="__codelineno-10-474" name="__codelineno-10-474" href="#__codelineno-10-474"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Invalid hex digest length.&quot;</span><span class="p">);</span>
</span><span id="__span-10-475"><a id="__codelineno-10-475" name="__codelineno-10-475" href="#__codelineno-10-475"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-476"><a id="__codelineno-10-476" name="__codelineno-10-476" href="#__codelineno-10-476"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-477"><a id="__codelineno-10-477" name="__codelineno-10-477" href="#__codelineno-10-477"></a><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">stoull</span><span class="p">(</span><span class="n">hex</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span>
</span><span id="__span-10-478"><a id="__codelineno-10-478" name="__codelineno-10-478" href="#__codelineno-10-478"></a><span class="w">    </span><span class="n">digest</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">part</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xFF000000</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">24</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">((</span><span class="n">part</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x00FF0000</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-10-479"><a id="__codelineno-10-479" name="__codelineno-10-479" href="#__codelineno-10-479"></a><span class="w">                </span><span class="p">((</span><span class="n">part</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x0000FF00</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">((</span><span class="n">part</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x000000FF</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">24</span><span class="p">);</span>
</span><span id="__span-10-480"><a id="__codelineno-10-480" name="__codelineno-10-480" href="#__codelineno-10-480"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-481"><a id="__codelineno-10-481" name="__codelineno-10-481" href="#__codelineno-10-481"></a><span class="p">}</span>
</span><span id="__span-10-482"><a id="__codelineno-10-482" name="__codelineno-10-482" href="#__codelineno-10-482"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-483"><a id="__codelineno-10-483" name="__codelineno-10-483" href="#__codelineno-10-483"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">ios_base</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
</span><span id="__span-10-484"><a id="__codelineno-10-484" name="__codelineno-10-484" href="#__codelineno-10-484"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
</span><span id="__span-10-485"><a id="__codelineno-10-485" name="__codelineno-10-485" href="#__codelineno-10-485"></a>
</span><span id="__span-10-486"><a id="__codelineno-10-486" name="__codelineno-10-486" href="#__codelineno-10-486"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">num_threads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">40</span><span class="p">;</span>
</span><span id="__span-10-487"><a id="__codelineno-10-487" name="__codelineno-10-487" href="#__codelineno-10-487"></a><span class="w">  </span><span class="n">omp_set_num_threads</span><span class="p">(</span><span class="n">num_threads</span><span class="p">);</span>
</span><span id="__span-10-488"><a id="__codelineno-10-488" name="__codelineno-10-488" href="#__codelineno-10-488"></a>
</span><span id="__span-10-489"><a id="__codelineno-10-489" name="__codelineno-10-489" href="#__codelineno-10-489"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">PHYSICAL_BATCH_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span><span class="w">         </span><span class="c1">// SIMD lane 数</span>
</span><span id="__span-10-490"><a id="__codelineno-10-490" name="__codelineno-10-490" href="#__codelineno-10-490"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">SIMD_BATCH_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w"> </span><span class="c1">// 8192</span>
</span><span id="__span-10-491"><a id="__codelineno-10-491" name="__codelineno-10-491" href="#__codelineno-10-491"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">STEPS_PER_JUMP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8192</span><span class="p">;</span><span class="w">      </span><span class="c1">// 每个 jump 单位跳 8192 步</span>
</span><span id="__span-10-492"><a id="__codelineno-10-492" name="__codelineno-10-492" href="#__codelineno-10-492"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">THREAD_BATCH_SIZE</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-493"><a id="__codelineno-10-493" name="__codelineno-10-493" href="#__codelineno-10-493"></a><span class="w">      </span><span class="n">SIMD_BATCH_SIZE</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">PHYSICAL_BATCH_SIZE</span><span class="p">;</span><span class="w"> </span><span class="c1">// 131072</span>
</span><span id="__span-10-494"><a id="__codelineno-10-494" name="__codelineno-10-494" href="#__codelineno-10-494"></a>
</span><span id="__span-10-495"><a id="__codelineno-10-495" name="__codelineno-10-495" href="#__codelineno-10-495"></a><span class="w">  </span><span class="k">static_assert</span><span class="p">(</span><span class="n">THREAD_BATCH_SIZE</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">STEPS_PER_JUMP</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-10-496"><a id="__codelineno-10-496" name="__codelineno-10-496" href="#__codelineno-10-496"></a><span class="w">                </span><span class="s">&quot;THREAD_BATCH_SIZE must be multiple of STEPS_PER_JUMP&quot;</span><span class="p">);</span>
</span><span id="__span-10-497"><a id="__codelineno-10-497" name="__codelineno-10-497" href="#__codelineno-10-497"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">JUMP_UNITS_PER_BATCH</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-498"><a id="__codelineno-10-498" name="__codelineno-10-498" href="#__codelineno-10-498"></a><span class="w">      </span><span class="n">THREAD_BATCH_SIZE</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">STEPS_PER_JUMP</span><span class="p">;</span><span class="w"> </span><span class="c1">// 应为 16</span>
</span><span id="__span-10-499"><a id="__codelineno-10-499" name="__codelineno-10-499" href="#__codelineno-10-499"></a>
</span><span id="__span-10-500"><a id="__codelineno-10-500" name="__codelineno-10-500" href="#__codelineno-10-500"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">test_case</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">test_case</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">test_case</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-501"><a id="__codelineno-10-501" name="__codelineno-10-501" href="#__codelineno-10-501"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">s0_hex</span><span class="p">,</span><span class="w"> </span><span class="n">s1_hex</span><span class="p">,</span><span class="w"> </span><span class="n">s2_hex</span><span class="p">;</span>
</span><span id="__span-10-502"><a id="__codelineno-10-502" name="__codelineno-10-502" href="#__codelineno-10-502"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">s0_hex</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">s1_hex</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">s2_hex</span><span class="p">))</span>
</span><span id="__span-10-503"><a id="__codelineno-10-503" name="__codelineno-10-503" href="#__codelineno-10-503"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-10-504"><a id="__codelineno-10-504" name="__codelineno-10-504" href="#__codelineno-10-504"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">target_hex</span><span class="p">;</span>
</span><span id="__span-10-505"><a id="__codelineno-10-505" name="__codelineno-10-505" href="#__codelineno-10-505"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">target_hex</span><span class="p">))</span>
</span><span id="__span-10-506"><a id="__codelineno-10-506" name="__codelineno-10-506" href="#__codelineno-10-506"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-10-507"><a id="__codelineno-10-507" name="__codelineno-10-507" href="#__codelineno-10-507"></a>
</span><span id="__span-10-508"><a id="__codelineno-10-508" name="__codelineno-10-508" href="#__codelineno-10-508"></a><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">stoull</span><span class="p">(</span><span class="n">s0_hex</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span>
</span><span id="__span-10-509"><a id="__codelineno-10-509" name="__codelineno-10-509" href="#__codelineno-10-509"></a><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">stoull</span><span class="p">(</span><span class="n">s1_hex</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span>
</span><span id="__span-10-510"><a id="__codelineno-10-510" name="__codelineno-10-510" href="#__codelineno-10-510"></a><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">stoull</span><span class="p">(</span><span class="n">s2_hex</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span>
</span><span id="__span-10-511"><a id="__codelineno-10-511" name="__codelineno-10-511" href="#__codelineno-10-511"></a>
</span><span id="__span-10-512"><a id="__codelineno-10-512" name="__codelineno-10-512" href="#__codelineno-10-512"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">target_digest</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span><span id="__span-10-513"><a id="__codelineno-10-513" name="__codelineno-10-513" href="#__codelineno-10-513"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-514"><a id="__codelineno-10-514" name="__codelineno-10-514" href="#__codelineno-10-514"></a><span class="w">      </span><span class="n">parse_hex_digest</span><span class="p">(</span><span class="n">target_hex</span><span class="p">,</span><span class="w"> </span><span class="n">target_digest</span><span class="p">);</span>
</span><span id="__span-10-515"><a id="__codelineno-10-515" name="__codelineno-10-515" href="#__codelineno-10-515"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-516"><a id="__codelineno-10-516" name="__codelineno-10-516" href="#__codelineno-10-516"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Error parsing target hash: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-10-517"><a id="__codelineno-10-517" name="__codelineno-10-517" href="#__codelineno-10-517"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-10-518"><a id="__codelineno-10-518" name="__codelineno-10-518" href="#__codelineno-10-518"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-519"><a id="__codelineno-10-519" name="__codelineno-10-519" href="#__codelineno-10-519"></a>
</span><span id="__span-10-520"><a id="__codelineno-10-520" name="__codelineno-10-520" href="#__codelineno-10-520"></a><span class="w">    </span><span class="k">volatile</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">found_n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
</span><span id="__span-10-521"><a id="__codelineno-10-521" name="__codelineno-10-521" href="#__codelineno-10-521"></a>
</span><span id="__span-10-522"><a id="__codelineno-10-522" name="__codelineno-10-522" href="#__codelineno-10-522"></a><span class="cp">#pragma omp parallel</span>
</span><span id="__span-10-523"><a id="__codelineno-10-523" name="__codelineno-10-523" href="#__codelineno-10-523"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-10-524"><a id="__codelineno-10-524" name="__codelineno-10-524" href="#__codelineno-10-524"></a><span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">thread_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">omp_get_thread_num</span><span class="p">();</span>
</span><span id="__span-10-525"><a id="__codelineno-10-525" name="__codelineno-10-525" href="#__codelineno-10-525"></a>
</span><span id="__span-10-526"><a id="__codelineno-10-526" name="__codelineno-10-526" href="#__codelineno-10-526"></a><span class="w">      </span><span class="n">RndGen</span><span class="w"> </span><span class="nf">generator</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span><span class="w"> </span><span class="n">s1</span><span class="p">,</span><span class="w"> </span><span class="n">s2</span><span class="p">);</span>
</span><span id="__span-10-527"><a id="__codelineno-10-527" name="__codelineno-10-527" href="#__codelineno-10-527"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">thread_id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-528"><a id="__codelineno-10-528" name="__codelineno-10-528" href="#__codelineno-10-528"></a><span class="w">        </span><span class="n">generator</span><span class="p">.</span><span class="n">jump_all_states_with_index</span><span class="p">(</span><span class="n">thread_id</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">PHYSICAL_BATCH_SIZE</span><span class="p">);</span>
</span><span id="__span-10-529"><a id="__codelineno-10-529" name="__codelineno-10-529" href="#__codelineno-10-529"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-10-530"><a id="__codelineno-10-530" name="__codelineno-10-530" href="#__codelineno-10-530"></a>
</span><span id="__span-10-531"><a id="__codelineno-10-531" name="__codelineno-10-531" href="#__codelineno-10-531"></a><span class="w">      </span><span class="n">md5_avx512_soa</span><span class="o">::</span><span class="n">MD5</span><span class="w"> </span><span class="n">md5_calc</span><span class="p">;</span>
</span><span id="__span-10-532"><a id="__codelineno-10-532" name="__codelineno-10-532" href="#__codelineno-10-532"></a><span class="w">      </span><span class="n">md5_calc</span><span class="p">.</span><span class="n">set_target_digest</span><span class="p">(</span><span class="n">target_digest</span><span class="p">);</span>
</span><span id="__span-10-533"><a id="__codelineno-10-533" name="__codelineno-10-533" href="#__codelineno-10-533"></a>
</span><span id="__span-10-534"><a id="__codelineno-10-534" name="__codelineno-10-534" href="#__codelineno-10-534"></a><span class="w">      </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">base_n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">thread_id</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">THREAD_BATCH_SIZE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-10-535"><a id="__codelineno-10-535" name="__codelineno-10-535" href="#__codelineno-10-535"></a>
</span><span id="__span-10-536"><a id="__codelineno-10-536" name="__codelineno-10-536" href="#__codelineno-10-536"></a><span class="w">      </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">found_n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-537"><a id="__codelineno-10-537" name="__codelineno-10-537" href="#__codelineno-10-537"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">simd_iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">simd_iter</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">SIMD_BATCH_SIZE</span><span class="p">;</span>
</span><span id="__span-10-538"><a id="__codelineno-10-538" name="__codelineno-10-538" href="#__codelineno-10-538"></a><span class="w">             </span><span class="o">++</span><span class="n">simd_iter</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-539"><a id="__codelineno-10-539" name="__codelineno-10-539" href="#__codelineno-10-539"></a><span class="w">          </span><span class="n">md5_calc</span><span class="p">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">generator</span><span class="p">);</span>
</span><span id="__span-10-540"><a id="__codelineno-10-540" name="__codelineno-10-540" href="#__codelineno-10-540"></a>
</span><span id="__span-10-541"><a id="__codelineno-10-541" name="__codelineno-10-541" href="#__codelineno-10-541"></a><span class="w">          </span><span class="kt">int</span><span class="w"> </span><span class="n">match_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">md5_calc</span><span class="p">.</span><span class="n">find_match_index</span><span class="p">();</span>
</span><span id="__span-10-542"><a id="__codelineno-10-542" name="__codelineno-10-542" href="#__codelineno-10-542"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">match_index</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-543"><a id="__codelineno-10-543" name="__codelineno-10-543" href="#__codelineno-10-543"></a><span class="w">            </span><span class="c1">// 计算真实 n 值</span>
</span><span id="__span-10-544"><a id="__codelineno-10-544" name="__codelineno-10-544" href="#__codelineno-10-544"></a><span class="w">            </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">current_n</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-10-545"><a id="__codelineno-10-545" name="__codelineno-10-545" href="#__codelineno-10-545"></a><span class="w">                </span><span class="n">base_n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">simd_iter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">match_index</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">SIMD_BATCH_SIZE</span><span class="p">;</span>
</span><span id="__span-10-546"><a id="__codelineno-10-546" name="__codelineno-10-546" href="#__codelineno-10-546"></a><span class="w">            </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
</span><span id="__span-10-547"><a id="__codelineno-10-547" name="__codelineno-10-547" href="#__codelineno-10-547"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">__atomic_compare_exchange</span><span class="p">(</span><span class="o">&amp;</span><span class="n">found_n</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">current_n</span><span class="p">,</span>
</span><span id="__span-10-548"><a id="__codelineno-10-548" name="__codelineno-10-548" href="#__codelineno-10-548"></a><span class="w">                                          </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">__ATOMIC_SEQ_CST</span><span class="p">,</span>
</span><span id="__span-10-549"><a id="__codelineno-10-549" name="__codelineno-10-549" href="#__codelineno-10-549"></a><span class="w">                                          </span><span class="n">__ATOMIC_SEQ_CST</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-550"><a id="__codelineno-10-550" name="__codelineno-10-550" href="#__codelineno-10-550"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-10-551"><a id="__codelineno-10-551" name="__codelineno-10-551" href="#__codelineno-10-551"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-10-552"><a id="__codelineno-10-552" name="__codelineno-10-552" href="#__codelineno-10-552"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-10-553"><a id="__codelineno-10-553" name="__codelineno-10-553" href="#__codelineno-10-553"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-10-554"><a id="__codelineno-10-554" name="__codelineno-10-554" href="#__codelineno-10-554"></a>
</span><span id="__span-10-555"><a id="__codelineno-10-555" name="__codelineno-10-555" href="#__codelineno-10-555"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">found_n</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-556"><a id="__codelineno-10-556" name="__codelineno-10-556" href="#__codelineno-10-556"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-10-557"><a id="__codelineno-10-557" name="__codelineno-10-557" href="#__codelineno-10-557"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-10-558"><a id="__codelineno-10-558" name="__codelineno-10-558" href="#__codelineno-10-558"></a>
</span><span id="__span-10-559"><a id="__codelineno-10-559" name="__codelineno-10-559" href="#__codelineno-10-559"></a><span class="w">        </span><span class="n">generator</span><span class="p">.</span><span class="n">jump_all_states_with_index</span><span class="p">(</span><span class="mi">40</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-10-560"><a id="__codelineno-10-560" name="__codelineno-10-560" href="#__codelineno-10-560"></a>
</span><span id="__span-10-561"><a id="__codelineno-10-561" name="__codelineno-10-561" href="#__codelineno-10-561"></a><span class="w">        </span><span class="n">base_n</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="mi">40</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">THREAD_BATCH_SIZE</span><span class="p">;</span>
</span><span id="__span-10-562"><a id="__codelineno-10-562" name="__codelineno-10-562" href="#__codelineno-10-562"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-10-563"><a id="__codelineno-10-563" name="__codelineno-10-563" href="#__codelineno-10-563"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-564"><a id="__codelineno-10-564" name="__codelineno-10-564" href="#__codelineno-10-564"></a>
</span><span id="__span-10-565"><a id="__codelineno-10-565" name="__codelineno-10-565" href="#__codelineno-10-565"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">found_n</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-566"><a id="__codelineno-10-566" name="__codelineno-10-566" href="#__codelineno-10-566"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">found_n</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-10-567"><a id="__codelineno-10-567" name="__codelineno-10-567" href="#__codelineno-10-567"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-568"><a id="__codelineno-10-568" name="__codelineno-10-568" href="#__codelineno-10-568"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-10-569"><a id="__codelineno-10-569" name="__codelineno-10-569" href="#__codelineno-10-569"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-570"><a id="__codelineno-10-570" name="__codelineno-10-570" href="#__codelineno-10-570"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-571"><a id="__codelineno-10-571" name="__codelineno-10-571" href="#__codelineno-10-571"></a>
</span><span id="__span-10-572"><a id="__codelineno-10-572" name="__codelineno-10-572" href="#__codelineno-10-572"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-10-573"><a id="__codelineno-10-573" name="__codelineno-10-573" href="#__codelineno-10-573"></a><span class="p">}</span>
</span></code></pre></div>
</details>

<!-- Source file information -->







  
  



<!-- Was this page helpful? -->


  



<!-- Comment system -->

      
    </article>
  </div>

          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../../../02/28/bupt-%E8%BD%AC%E4%B8%93%E4%B8%9A%E5%B0%8F%E8%AE%B0/" class="md-footer__link md-footer__link--prev" aria-label="上一页: BUPT 转专业小记">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                BUPT 转专业小记
              </div>
            </div>
          </a>
        
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <a href="https://icp.gov.moe/?keyword=20250039" target="_blank">萌ICP备20250039号</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/liulifox233" target="_blank" rel="noopener" title="Ruri on Github" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.action.edit", "content.action.view", "content.code.annotate", "navigation.expand", "toc.follow", "search.suggest", "navigation.top", "search.share", "navigation.indexes", "navigation.footer", "navigation.tracking", "search.highlight", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tabs", "content.tabs.link", "content.code.copy"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../../../../javascripts/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
        <script src="https://unpkg.com/d3@7/dist/d3.min.js"></script>
      
        <script src="../../../../javascripts/hpc-visualizations.js"></script>
      
        <script src="../../../../javascripts/chat.js"></script>
      
    
  </body>
</html>